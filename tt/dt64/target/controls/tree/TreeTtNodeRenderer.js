"use strict";

define(['../../src/index', '../util'], function (tt, util) {
  var TreeTtNodeRenderer = tt.core.defineClass({
    init: function init(treeNode) {
      treeNode.childNodes = treeNode.childNodes || [];
      tt.initList(treeNode.childNodes);
      tt.initProperty(treeNode, 'label');
      this.treeNode = treeNode;
      this.wasExpanded = false;
      this.expanded = false;
      tt.initProperty(this, 'expanded');
      this.containerNode = tt.createTtNode({
        type: 'div',
        css: ['tree-node'],
        data: treeNode,
        draggable: 'true',
        id: tt.core.generateId(),
        dragstart: function dragstart(event) {
          event.stopPropagation();
          event.dataTransfer.effectAllowed = 'copyMove';
          event.dataTransfer.setData('text/plain', event.target.id);
        },
        dragover: function dragover(event) {
          event.preventDefault();
        },
        dragenter: function dragenter(event) {
          //var target = event.currentTarget;
          //target.classList.add('tree-drop-target');
          return false;
        },
        dragleave: function dragleave(event) {
          //var target = event.currentTarget;
          //target.classList.remove('tree-drop-target');
          return false;
        },
        drop: function (event) {
          event.preventDefault();

          if (event.stopPropagation) {
            event.stopPropagation();
          }

          var sourceId = event.dataTransfer.getData('text/plain');
          var sourceNode = document.getElementById(sourceId);
          var sourceTreeNode = sourceNode.__ttNode.data; //this.containerNode.domNode.classList.remove('tree-drop-target');

          this.treeNode.drop && this.treeNode.drop(sourceTreeNode, event);
        }.bind(this),
        children: [this.createTitleNode()]
      });
    },
    createTitleNode: function createTitleNode() {
      return tt.createTtNode({
        type: 'div',
        css: ['tree-node-header'],
        children: [util.createIconTtNode({
          click: this.expand.bind(this),
          icon: function () {
            if (this.treeNode.childNodes.getLength() === 0) {
              return ['far', 'fa-square', 'tree-expand-icon'];
            }

            return this.getExpanded() ? ['far', 'fa-minus-square', 'tree-expand-icon'] : ['far', 'fa-plus-square', 'tree-expand-icon'];
          }.bind(this)
        }), tt.createTtNode({
          type: 'div',
          css: ['tree-node-header-label'],
          children: this.treeNode.labelTtNodes
        })]
      });
    },
    expand: function expand() {
      if (this.treeNode.childNodes.getLength() === 0) {
        return;
      }

      if (!this.wasExpanded) {
        this.handleFirstExpand();
        return;
      }

      if (this.getExpanded()) {
        this.childrenContainerNode.css.splice(0, 0, 'tree-display-none');
        this.setExpanded(false);
      } else {
        this.childrenContainerNode.css.splice(0, 1);
        this.setExpanded(true);
      }
    },
    handleFirstExpand: function handleFirstExpand() {
      this.childrenContainerNode = tt.createTtNode({
        type: 'div',
        css: ['tree-node-children'],
        children: tt.createMappedList(this.treeNode.childNodes, createTreeTtNode)
      });
      this.containerNode.children.splice(1, 0, this.childrenContainerNode);
      this.wasExpanded = true;
      this.setExpanded(true);
    },
    render: function render() {
      return this.containerNode;
    }
  });
  var createTreeTtNode = tt.createTtNodeCreator(TreeTtNodeRenderer);
  TreeTtNodeRenderer.createTreeTtNode = createTreeTtNode;
  return TreeTtNodeRenderer;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2NvbnRyb2xzL3RyZWUvVHJlZVR0Tm9kZVJlbmRlcmVyLmpzIl0sIm5hbWVzIjpbImRlZmluZSIsInR0IiwidXRpbCIsIlRyZWVUdE5vZGVSZW5kZXJlciIsImNvcmUiLCJkZWZpbmVDbGFzcyIsImluaXQiLCJ0cmVlTm9kZSIsImNoaWxkTm9kZXMiLCJpbml0TGlzdCIsImluaXRQcm9wZXJ0eSIsIndhc0V4cGFuZGVkIiwiZXhwYW5kZWQiLCJjb250YWluZXJOb2RlIiwiY3JlYXRlVHROb2RlIiwidHlwZSIsImNzcyIsImRhdGEiLCJkcmFnZ2FibGUiLCJpZCIsImdlbmVyYXRlSWQiLCJkcmFnc3RhcnQiLCJldmVudCIsInN0b3BQcm9wYWdhdGlvbiIsImRhdGFUcmFuc2ZlciIsImVmZmVjdEFsbG93ZWQiLCJzZXREYXRhIiwidGFyZ2V0IiwiZHJhZ292ZXIiLCJwcmV2ZW50RGVmYXVsdCIsImRyYWdlbnRlciIsImRyYWdsZWF2ZSIsImRyb3AiLCJzb3VyY2VJZCIsImdldERhdGEiLCJzb3VyY2VOb2RlIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInNvdXJjZVRyZWVOb2RlIiwiX190dE5vZGUiLCJiaW5kIiwiY2hpbGRyZW4iLCJjcmVhdGVUaXRsZU5vZGUiLCJjcmVhdGVJY29uVHROb2RlIiwiY2xpY2siLCJleHBhbmQiLCJpY29uIiwiZ2V0TGVuZ3RoIiwiZ2V0RXhwYW5kZWQiLCJsYWJlbFR0Tm9kZXMiLCJoYW5kbGVGaXJzdEV4cGFuZCIsImNoaWxkcmVuQ29udGFpbmVyTm9kZSIsInNwbGljZSIsInNldEV4cGFuZGVkIiwiY3JlYXRlTWFwcGVkTGlzdCIsImNyZWF0ZVRyZWVUdE5vZGUiLCJyZW5kZXIiLCJjcmVhdGVUdE5vZGVDcmVhdG9yIl0sIm1hcHBpbmdzIjoiOztBQUFBQSxNQUFNLENBQUMsQ0FBQyxpQkFBRCxFQUFvQixTQUFwQixDQUFELEVBQWlDLFVBQVVDLEVBQVYsRUFBY0MsSUFBZCxFQUFvQjtBQUV2RCxN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SCxhQUFLRixxQkFBTCxDQUEyQm5DLEdBQTNCLENBQStCb0MsTUFBL0IsQ0FBc0MsQ0FBdEMsRUFBeUMsQ0FBekM7QUFDQSxhQUFLQyxXQUFMLENBQWlCLElBQWpCO0FBQ0g7QUFDSixLQXZGd0M7QUF5RnpDSCxJQUFBQSxpQkFBaUIsRUFBRSw2QkFBWTtBQUMzQixXQUFLQyxxQkFBTCxHQUE2QmxELEVBQUUsQ0FBQ2EsWUFBSCxDQUFnQjtBQUN6Q0MsUUFBQUEsSUFBSSxFQUFFLEtBRG1DO0FBRXpDQyxRQUFBQSxHQUFHLEVBQUUsQ0FBQyxvQkFBRCxDQUZvQztBQUd6Q3lCLFFBQUFBLFFBQVEsRUFBRXhDLEVBQUUsQ0FBQ3FELGdCQUFILENBQW9CLEtBQUsvQyxRQUFMLENBQWNDLFVBQWxDLEVBQThDK0MsZ0JBQTlDO0FBSCtCLE9BQWhCLENBQTdCO0FBS0EsV0FBSzFDLGFBQUwsQ0FBbUI0QixRQUFuQixDQUE0QlcsTUFBNUIsQ0FBbUMsQ0FBbkMsRUFBc0MsQ0FBdEMsRUFBeUMsS0FBS0QscUJBQTlDO0FBQ0EsV0FBS3hDLFdBQUwsR0FBbUIsSUFBbkI7QUFDQSxXQUFLMEMsV0FBTCxDQUFpQixJQUFqQjtBQUNILEtBbEd3QztBQW9HekNHLElBQUFBLE1BQU0sRUFBRSxrQkFBWTtBQUNoQixhQUFPLEtBQUszQyxhQUFaO0FBQ0g7QUF0R3dDLEdBQXBCLENBQXpCO0FBMEdBLE1BQUkwQyxnQkFBZ0IsR0FBR3RELEVBQUUsQ0FBQ3dELG1CQUFILENBQXVCdEQsa0JBQXZCLENBQXZCO0FBRUFBLEVBQUFBLGtCQUFrQixDQUFDb0QsZ0JBQW5CLEdBQXNDQSxnQkFBdEM7QUFFQSxTQUFPcEQsa0JBQVA7QUFFSCxDQWxISyxDQUFOIiwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFsnLi4vLi4vc3JjL2luZGV4JywgJy4uL3V0aWwnXSwgZnVuY3Rpb24gKHR0LCB1dGlsKSB7XG5cbiAgICB2YXIgVHJlZVR0Tm9kZVJlbmRlcmVyID0gdHQuY29yZS5kZWZpbmVDbGFzcyh7XG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHRyZWVOb2RlKSB7XG4gICAgICAgICAgICB0cmVlTm9kZS5jaGlsZE5vZGVzID0gdHJlZU5vZGUuY2hpbGROb2RlcyB8fCBbXTtcbiAgICAgICAgICAgIHR0LmluaXRMaXN0KHRyZWVOb2RlLmNoaWxkTm9kZXMpO1xuICAgICAgICAgICAgdHQuaW5pdFByb3BlcnR5KHRyZWVOb2RlLCAnbGFiZWwnKTtcbiAgICAgICAgICAgIHRoaXMudHJlZU5vZGUgPSB0cmVlTm9kZTtcbiAgICAgICAgICAgIHRoaXMud2FzRXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHR0LmluaXRQcm9wZXJ0eSh0aGlzLCAnZXhwYW5kZWQnKTtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyTm9kZSA9IHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgY3NzOiBbJ3RyZWUtbm9kZSddLFxuICAgICAgICAgICAgICAgIGRhdGE6IHRyZWVOb2RlLFxuICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogJ3RydWUnLFxuICAgICAgICAgICAgICAgIGlkOiB0dC5jb3JlLmdlbmVyYXRlSWQoKSxcbiAgICAgICAgICAgICAgICBkcmFnc3RhcnQ6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyLmVmZmVjdEFsbG93ZWQgPSAnY29weU1vdmUnO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIuc2V0RGF0YSgndGV4dC9wbGFpbicsIGV2ZW50LnRhcmdldC5pZCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkcmFnb3ZlcjogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkcmFnZW50ZXI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAvL3ZhciB0YXJnZXQgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAvL3RhcmdldC5jbGFzc0xpc3QuYWRkKCd0cmVlLWRyb3AtdGFyZ2V0Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRyYWdsZWF2ZTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIHRhcmdldCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgIC8vdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ3RyZWUtZHJvcC10YXJnZXQnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZHJvcDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5zdG9wUHJvcGFnYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2VJZCA9IGV2ZW50LmRhdGFUcmFuc2Zlci5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2VOb2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc291cmNlSWQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlVHJlZU5vZGUgPSBzb3VyY2VOb2RlLl9fdHROb2RlLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIC8vdGhpcy5jb250YWluZXJOb2RlLmRvbU5vZGUuY2xhc3NMaXN0LnJlbW92ZSgndHJlZS1kcm9wLXRhcmdldCcpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyZWVOb2RlLmRyb3AgJiYgdGhpcy50cmVlTm9kZS5kcm9wKHNvdXJjZVRyZWVOb2RlLCBldmVudCk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbdGhpcy5jcmVhdGVUaXRsZU5vZGUoKV1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZVRpdGxlTm9kZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgY3NzOiBbJ3RyZWUtbm9kZS1oZWFkZXInXSxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAgICAgICAgICB1dGlsLmNyZWF0ZUljb25UdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2s6IHRoaXMuZXhwYW5kLmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudHJlZU5vZGUuY2hpbGROb2Rlcy5nZXRMZW5ndGgoKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWydmYXInLCAnZmEtc3F1YXJlJywgJ3RyZWUtZXhwYW5kLWljb24nXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RXhwYW5kZWQoKSA/IFsnZmFyJywgJ2ZhLW1pbnVzLXNxdWFyZScsICd0cmVlLWV4cGFuZC1pY29uJ10gOiBbJ2ZhcicsICdmYS1wbHVzLXNxdWFyZScsICd0cmVlLWV4cGFuZC1pY29uJ107XG4gICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzczogWyd0cmVlLW5vZGUtaGVhZGVyLWxhYmVsJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy50cmVlTm9kZS5sYWJlbFR0Tm9kZXNcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIGV4cGFuZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudHJlZU5vZGUuY2hpbGROb2Rlcy5nZXRMZW5ndGgoKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy53YXNFeHBhbmRlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlRmlyc3RFeHBhbmQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5nZXRFeHBhbmRlZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbkNvbnRhaW5lck5vZGUuY3NzLnNwbGljZSgwLCAwLCAndHJlZS1kaXNwbGF5LW5vbmUnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEV4cGFuZGVkKGZhbHNlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGlsZHJlbkNvbnRhaW5lck5vZGUuY3NzLnNwbGljZSgwLCAxKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEV4cGFuZGVkKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhhbmRsZUZpcnN0RXhwYW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuQ29udGFpbmVyTm9kZSA9IHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgY3NzOiBbJ3RyZWUtbm9kZS1jaGlsZHJlbiddLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuOiB0dC5jcmVhdGVNYXBwZWRMaXN0KHRoaXMudHJlZU5vZGUuY2hpbGROb2RlcywgY3JlYXRlVHJlZVR0Tm9kZSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyTm9kZS5jaGlsZHJlbi5zcGxpY2UoMSwgMCwgdGhpcy5jaGlsZHJlbkNvbnRhaW5lck5vZGUpO1xuICAgICAgICAgICAgdGhpcy53YXNFeHBhbmRlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnNldEV4cGFuZGVkKHRydWUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyTm9kZTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cbiAgICB2YXIgY3JlYXRlVHJlZVR0Tm9kZSA9IHR0LmNyZWF0ZVR0Tm9kZUNyZWF0b3IoVHJlZVR0Tm9kZVJlbmRlcmVyKTtcblxuICAgIFRyZWVUdE5vZGVSZW5kZXJlci5jcmVhdGVUcmVlVHROb2RlID0gY3JlYXRlVHJlZVR0Tm9kZTtcblxuICAgIHJldHVybiBUcmVlVHROb2RlUmVuZGVyZXI7XG5cbn0pOyJdfQ==