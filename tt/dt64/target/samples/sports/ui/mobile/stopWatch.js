"use strict";

define(['../../../../src/index'], function (tt) {
  var module = {
    createTtNode: tt.createTtNodeCreator({
      init: function init(params) {
        params.minutes = params.minutes || 0;
        this.duration = params.minutes * 60 + params.seconds;
        tt.initProperty(this, 'displayTime');
        tt.initProperty(this, 'status');
        this.finished = params.finished;
        this.reset();
      },
      reset: function reset() {
        if (this.updateInterval) {
          clearInterval(this.updateInterval);
          this.updateInterval = null;
        }

        this.setStatus('initial');
        this.pauseTime = 0;
        this.updateDisplay(this.duration);
      },
      toggle: function toggle() {
        this.update();

        switch (this.getStatus()) {
          case 'initial':
            this.startTime = this.getCurrentTime();
            this.updateInterval = window.setInterval(this.update.bind(this), 100);
            this.setStatus('running');
            break;

          case 'running':
            this.pauseStart = this.getCurrentTime();
            this.setStatus('paused');
            break;

          case 'paused':
            this.pauseTime += this.getCurrentTime() - this.pauseStart;
            this.setStatus('running');
            break;

          case 'finished':
            break;
        }
      },
      getCurrentTime: function getCurrentTime() {
        return new Date().getTime() / 1000;
      },
      render: function render() {
        return tt.createTtNode({
          type: 'div',
          css: ['stop-watch'],
          children: [tt.createTtNode({
            type: 'i',
            css: function () {
              switch (this.getStatus()) {
                case 'initial':
                  return ['fas', 'fa-play', 'stop-watch-toggle'];

                case 'running':
                  return ['fas', 'fa-pause', 'stop-watch-toggle'];

                case 'paused':
                  return ['fas', 'fa-play', 'stop-watch-toggle'];

                case 'finished':
                  return ['fas', 'fa-check', 'stop-watch-toggle'];
              }
            }.bind(this),
            click: function () {
              this.toggle();
            }.bind(this)
          }), tt.createTtNode({
            type: 'i',
            css: ['fas', 'fa-undo',, 'stop-watch-reset'],
            click: function () {
              this.reset();
            }.bind(this)
          }), tt.createTtNode({
            type: 'div',
            css: ['stop-watch-time'],
            text: function () {
              return this.getDisplayTime();
            }.bind(this)
          })]
        });
      },
      pad: function pad(num, size) {
        var s = "000000000" + num;
        return s.substr(s.length - size);
      },
      update: function update() {
        if (this.getStatus() !== 'running') {
          return;
        }

        var elapsedTime = this.getCurrentTime() - this.startTime;
        var remainingTime = this.duration - elapsedTime + this.pauseTime;

        if (remainingTime <= 0) {
          remainingTime = 0;
          window.clearInterval(this.updateInterval);
          this.updateInterval = null;
          this.setStatus('finished');

          if (this.finished) {
            this.finished();
          }
        }

        this.updateDisplay(remainingTime);
      },

      updateDisplay(remainingTime) {
        var remainingTimeMinutes = this.pad(Math.floor(remainingTime / 60), 2);
        var remainingTimeSeconds = this.pad(Math.floor(remainingTime - remainingTimeMinutes * 60), 2);
        this.setDisplayTime(remainingTimeMinutes + ':' + remainingTimeSeconds);
      }

    })
  };
  return module;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NhbXBsZXMvc3BvcnRzL3VpL21vYmlsZS9zdG9wV2F0Y2guanMiXSwibmFtZXMiOlsiZGVmaW5lIiwidHQiLCJtb2R1bGUiLCJjcmVhdGVUdE5vZGUiLCJjcmVhdGVUdE5vZGVDcmVhdG9yIiwiaW5pdCIsInBhcmFtcyIsIm1pbnV0ZXMiLCJkdXJhdGlvbiIsInNlY29uZHMiLCJpbml0UHJvcGVydHkiLCJmaW5pc2hlZCIsInJlc2V0IiwidXBkYXRlSW50ZXJ2YWwiLCJjbGVhckludGVydmFsIiwic2V0U3RhdHVzIiwicGF1c2VUaW1lIiwidXBkYXRlRGlzcGxheSIsInRvZ2dsZSIsInVwZGF0ZSIsImdldFN0YXR1cyIsInN0YXJ0VGltZSIsImdldEN1cnJlbnRUaW1lIiwid2luZG93Iiwic2V0SW50ZXJ2YWwiLCJiaW5kIiwicGF1c2VTdGFydCIsIkRhdGUiLCJnZXRUaW1lIiwicmVuZGVyIiwidHlwZSIsImNzcyIsImNoaWxkcmVuIiwiY2xpY2siLCJ0ZXh0IiwiZ2V0RGlzcGxheVRpbWUiLCJwYWQiLCJudW0iLCJzaXplIiwicyIsInN1YnN0ciIsImxlbmd0aCIsImVsYXBzZWRUaW1lIiwicmVtYWluaW5nVGltZSIsInJlbWFpbmluZ1RpbWVNaW51dGVzIiwiTWF0aCIsImZsb29yIiwicmVtYWluaW5nVGltZVNlY29uZHMiLCJzZXREaXNwbGF5VGltZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQUEsTUFBTSxDQUFDLENBQUMsdUJBQUQsQ0FBRCxFQUE0QixVQUFVQyxFQUFWLEVBQWM7QUFFNUMsTUFBSUMsTUFBTSxHQUFHO0FBRVRDLElBQUFBLFlBQVksRUFBRUYsRUFBRSxDQUFDRyxtQkFBSCxDQUF1QjtBQUNqQ0MsTUFBQUEsSUFBSSxFQUFFLGNBQVVDLE1BQVYsRUFBa0I7QUFDcEJBLFFBQUFBLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQkQsTUFBTSxDQUFDQyxPQUFQLElBQWtCLENBQW5DO0FBQ0EsYUFBS0MsUUFBTCxHQUFnQkYs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aUJBQUtBLFFBQUw7QUFDSDtBQUNKOztBQUNELGFBQUtNLGFBQUwsQ0FBbUIwQixhQUFuQjtBQUNILE9BckdnQzs7QUFzR2pDMUIsTUFBQUEsYUFBYSxDQUFDMEIsYUFBRCxFQUFnQjtBQUN6QixZQUFJQyxvQkFBb0IsR0FBRyxLQUFLUixHQUFMLENBQVNTLElBQUksQ0FBQ0MsS0FBTCxDQUFXSCxhQUFhLEdBQUcsRUFBM0IsQ0FBVCxFQUF5QyxDQUF6QyxDQUEzQjtBQUNBLFlBQUlJLG9CQUFvQixHQUFHLEtBQUtYLEdBQUwsQ0FBU1MsSUFBSSxDQUFDQyxLQUFMLENBQVdILGFBQWEsR0FBR0Msb0JBQW9CLEdBQUcsRUFBbEQsQ0FBVCxFQUFnRSxDQUFoRSxDQUEzQjtBQUNBLGFBQUtJLGNBQUwsQ0FBb0JKLG9CQUFvQixHQUFHLEdBQXZCLEdBQTZCRyxvQkFBakQ7QUFDSDs7QUExR2dDLEtBQXZCO0FBRkwsR0FBYjtBQWlIQSxTQUFPN0MsTUFBUDtBQUVILENBckhLLENBQU4iLCJzb3VyY2VzQ29udGVudCI6WyJkZWZpbmUoWycuLi8uLi8uLi8uLi9zcmMvaW5kZXgnXSwgZnVuY3Rpb24gKHR0KSB7XG5cbiAgICB2YXIgbW9kdWxlID0ge1xuXG4gICAgICAgIGNyZWF0ZVR0Tm9kZTogdHQuY3JlYXRlVHROb2RlQ3JlYXRvcih7XG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLm1pbnV0ZXMgPSBwYXJhbXMubWludXRlcyB8fCAwO1xuICAgICAgICAgICAgICAgIHRoaXMuZHVyYXRpb24gPSBwYXJhbXMubWludXRlcyAqIDYwICsgcGFyYW1zLnNlY29uZHM7XG4gICAgICAgICAgICAgICAgdHQuaW5pdFByb3BlcnR5KHRoaXMsICdkaXNwbGF5VGltZScpO1xuICAgICAgICAgICAgICAgIHR0LmluaXRQcm9wZXJ0eSh0aGlzLCAnc3RhdHVzJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZCA9IHBhcmFtcy5maW5pc2hlZDtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy51cGRhdGVJbnRlcnZhbCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudXBkYXRlSW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUludGVydmFsID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoJ2luaXRpYWwnKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlVGltZSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuZHVyYXRpb24pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvZ2dsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLmdldFN0YXR1cygpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2luaXRpYWwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUgPSB0aGlzLmdldEN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUludGVydmFsID0gd2luZG93LnNldEludGVydmFsKHRoaXMudXBkYXRlLmJpbmQodGhpcyksIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cygncnVubmluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3J1bm5pbmcnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXVzZVN0YXJ0ID0gdGhpcy5nZXRDdXJyZW50VGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoJ3BhdXNlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3BhdXNlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdXNlVGltZSArPSB0aGlzLmdldEN1cnJlbnRUaW1lKCkgLSB0aGlzLnBhdXNlU3RhcnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cygncnVubmluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZpbmlzaGVkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDdXJyZW50VGltZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAobmV3IERhdGUoKSkuZ2V0VGltZSgpIC8gMTAwMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIGNzczogWydzdG9wLXdhdGNoJ10sXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLmdldFN0YXR1cygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdpbml0aWFsJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWydmYXMnLCAnZmEtcGxheScsICdzdG9wLXdhdGNoLXRvZ2dsZSddO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncnVubmluZyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsnZmFzJywgJ2ZhLXBhdXNlJywgJ3N0b3Atd2F0Y2gtdG9nZ2xlJ107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdwYXVzZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbJ2ZhcycsICdmYS1wbGF5JywgJ3N0b3Atd2F0Y2gtdG9nZ2xlJ107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmaW5pc2hlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsnZmFzJywgJ2ZhLWNoZWNrJywgJ3N0b3Atd2F0Y2gtdG9nZ2xlJ107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ2ZhcycsICdmYS11bmRvJywgLCAnc3RvcC13YXRjaC1yZXNldCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3M6IFsnc3RvcC13YXRjaC10aW1lJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXREaXNwbGF5VGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhZDogZnVuY3Rpb24gKG51bSwgc2l6ZSkge1xuICAgICAgICAgICAgICAgIHZhciBzID0gXCIwMDAwMDAwMDBcIiArIG51bTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcy5zdWJzdHIocy5sZW5ndGggLSBzaXplKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXRTdGF0dXMoKSAhPT0gJ3J1bm5pbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGVsYXBzZWRUaW1lID0gdGhpcy5nZXRDdXJyZW50VGltZSgpIC0gdGhpcy5zdGFydFRpbWU7XG4gICAgICAgICAgICAgICAgdmFyIHJlbWFpbmluZ1RpbWUgPSB0aGlzLmR1cmF0aW9uIC0gZWxhcHNlZFRpbWUgKyB0aGlzLnBhdXNlVGltZTtcbiAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nVGltZSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ1RpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLnVwZGF0ZUludGVydmFsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVJbnRlcnZhbCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdHVzKCdmaW5pc2hlZCcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5maW5pc2hlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5pc2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGlzcGxheShyZW1haW5pbmdUaW1lKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVEaXNwbGF5KHJlbWFpbmluZ1RpbWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVtYWluaW5nVGltZU1pbnV0ZXMgPSB0aGlzLnBhZChNYXRoLmZsb29yKHJlbWFpbmluZ1RpbWUgLyA2MCksIDIpO1xuICAgICAgICAgICAgICAgIHZhciByZW1haW5pbmdUaW1lU2Vjb25kcyA9IHRoaXMucGFkKE1hdGguZmxvb3IocmVtYWluaW5nVGltZSAtIHJlbWFpbmluZ1RpbWVNaW51dGVzICogNjApLCAyKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldERpc3BsYXlUaW1lKHJlbWFpbmluZ1RpbWVNaW51dGVzICsgJzonICsgcmVtYWluaW5nVGltZVNlY29uZHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgfTtcblxuICAgIHJldHVybiBtb2R1bGU7XG5cbn0pO1xuIl19