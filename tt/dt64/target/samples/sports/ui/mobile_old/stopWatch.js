"use strict";

define(['../../../../src/index'], function (tt) {
  var module = {
    createTtNode: tt.createTtNodeCreator({
      init: function init(params) {
        params.minutes = params.minutes || 0;
        this.duration = params.minutes * 60 + params.seconds;
        tt.initProperty(this, 'displayTime');
        tt.initProperty(this, 'status');
        this.finished = params.finished;
        this.reset();
      },
      reset: function reset() {
        if (this.updateInterval) {
          clearInterval(this.updateInterval);
          this.updateInterval = null;
        }

        this.setStatus('initial');
        this.pauseTime = 0;
        this.updateDisplay(this.duration);
      },
      toggle: function toggle() {
        this.update();

        switch (this.getStatus()) {
          case 'initial':
            this.startTime = this.getCurrentTime();
            this.updateInterval = window.setInterval(this.update.bind(this), 100);
            this.setStatus('running');
            break;

          case 'running':
            this.pauseStart = this.getCurrentTime();
            this.setStatus('paused');
            break;

          case 'paused':
            this.pauseTime += this.getCurrentTime() - this.pauseStart;
            this.setStatus('running');
            break;

          case 'finished':
            break;
        }
      },
      getCurrentTime: function getCurrentTime() {
        return new Date().getTime() / 1000;
      },
      render: function render() {
        return tt.createTtNode({
          type: 'div',
          css: ['stop-watch'],
          children: [tt.createTtNode({
            type: 'i',
            css: function () {
              switch (this.getStatus()) {
                case 'initial':
                  return ['fas', 'fa-play', 'stop-watch-toggle'];

                case 'running':
                  return ['fas', 'fa-pause', 'stop-watch-toggle'];

                case 'paused':
                  return ['fas', 'fa-play', 'stop-watch-toggle'];

                case 'finished':
                  return ['fas', 'fa-check', 'stop-watch-toggle'];
              }
            }.bind(this),
            click: function () {
              this.toggle();
            }.bind(this)
          }), tt.createTtNode({
            type: 'i',
            css: ['fas', 'fa-undo',, 'stop-watch-reset'],
            click: function () {
              this.reset();
            }.bind(this)
          }), tt.createTtNode({
            type: 'div',
            css: ['stop-watch-time'],
            text: function () {
              return this.getDisplayTime();
            }.bind(this)
          })]
        });
      },
      pad: function pad(num, size) {
        var s = "000000000" + num;
        return s.substr(s.length - size);
      },
      update: function update() {
        if (this.getStatus() !== 'running') {
          return;
        }

        var elapsedTime = this.getCurrentTime() - this.startTime;
        var remainingTime = this.duration - elapsedTime + this.pauseTime;

        if (remainingTime <= 0) {
          remainingTime = 0;
          window.clearInterval(this.updateInterval);
          this.updateInterval = null;
          this.setStatus('finished');

          if (this.finished) {
            this.finished();
          }
        }

        this.updateDisplay(remainingTime);
      },

      updateDisplay(remainingTime) {
        var remainingTimeMinutes = this.pad(Math.floor(remainingTime / 60), 2);
        var remainingTimeSeconds = this.pad(Math.floor(remainingTime - remainingTimeMinutes * 60), 2);
        this.setDisplayTime(remainingTimeMinutes + ':' + remainingTimeSeconds);
      }

    })
  };
  return module;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NhbXBsZXMvc3BvcnRzL3VpL21vYmlsZV9vbGQvc3RvcFdhdGNoLmpzIl0sIm5hbWVzIjpbImRlZmluZSIsInR0IiwibW9kdWxlIiwiY3JlYXRlVHROb2RlIiwiY3JlYXRlVHROb2RlQ3JlYXRvciIsImluaXQiLCJwYXJhbXMiLCJtaW51dGVzIiwiZHVyYXRpb24iLCJzZWNvbmRzIiwiaW5pdFByb3BlcnR5IiwiZmluaXNoZWQiLCJyZXNldCIsInVwZGF0ZUludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsInNldFN0YXR1cyIsInBhdXNlVGltZSIsInVwZGF0ZURpc3BsYXkiLCJ0b2dnbGUiLCJ1cGRhdGUiLCJnZXRTdGF0dXMiLCJzdGFydFRpbWUiLCJnZXRDdXJyZW50VGltZSIsIndpbmRvdyIsInNldEludGVydmFsIiwiYmluZCIsInBhdXNlU3RhcnQiLCJEYXRlIiwiZ2V0VGltZSIsInJlbmRlciIsInR5cGUiLCJjc3MiLCJjaGlsZHJlbiIsImNsaWNrIiwidGV4dCIsImdldERpc3BsYXlUaW1lIiwicGFkIiwibnVtIiwic2l6ZSIsInMiLCJzdWJzdHIiLCJsZW5ndGgiLCJlbGFwc2VkVGltZSIsInJlbWFpbmluZ1RpbWUiLCJyZW1haW5pbmdUaW1lTWludXRlcyIsIk1hdGgiLCJmbG9vciIsInJlbWFpbmluZ1RpbWVTZWNvbmRzIiwic2V0RGlzcGxheVRpbWUiXSwibWFwcGluZ3MiOiI7O0FBQUFBLE1BQU0sQ0FBQyxDQUFDLHVCQUFELENBQUQsRUFBNEIsVUFBVUMsRUFBVixFQUFjO0FBRTVDLE1BQUlDLE1BQU0sR0FBRztBQUVUQyxJQUFBQSxZQUFZLEVBQUVGLEVBQUUsQ0FBQ0csbUJBQUgsQ0FBdUI7QUFDakNDLE1BQUFBLElBQUksRUFBRSxjQUFVQyxNQUFWLEVBQWtCO0FBQ3BCQSxRQUFBQSxNQUFNLENBQUNDLE9BQVAsR0FBaUJELE1BQU0sQ0FBQ0MsT0FBUCxJQUFrQixDQUFuQztBQUNBLGFBQUtDLFFBQUwsR0FBZ0JGLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixFQUFqQixHQUFzQkQsTUFBTSxDQUFDRyxPQUE3QztBQUNBUixRQUFBQSxFQUFFLENBQUNTLFlBQUgsQ0FBZ0IsSUFBaEIsRUFBc0IsYUFBdEI7QUFDQVQsUUFBQUEsRUFBRSxDQUFDUyxZQUFILENBQWdCLElBQWhCLEVBQXNCLFFBQXRCO0FBQ0EsYUFBS0MsUUFBTCxHQUFnQkwsTUFBTSxDQUFDSyxRQUF2QjtBQUNBLGFBQUtDLEtBQUw7QUFDSCxPQVJnQztBQVNqQ0EsTUFBQUEsS0FBSyxFQUFFLGlCQUFZO0FBQ2YsWUFBSSxLQUFLQyxjQUFULEVBQXlCO0FBQ3JCQyxVQUFBQSxhQUFhLENBQUMsS0FBS0QsY0FBTixDQUFiO0FBQ0EsZUFBS0EsY0FBTCxHQUFzQixJQUF0QjtBQUNIOztBQUNELGFBQUtFLFNBQUwsQ0FBZSxTQUFmO0FBQ0EsYUFBS0MsU0FBTCxHQUFpQixDQUFqQjtBQUNBLGFBQUtDLGFBQUwsQ0FBbUIsS0FBS1QsUUFBeEI7QUFDSCxPQWpCZ0M7QUFrQmpDVSxNQUFBQSxNQUFNLEVBQUUsa0JBQVk7QUFDaEIsYUFBS0MsTUFBTDs7QUFDQSxnQkFBUSxLQUFLQyxTQUFMLEVBQVI7QUFDSSxlQUFLLFNBQUw7QUFDSSxpQkFBS0MsU0FBTCxHQUFpQixLQUFLQyxjQUFMLEVBQWpCO0FBQ0EsaUJBQUtULGNBQUwsR0FBc0JVLE1BQU0sQ0FBQ0MsV0FBUCxDQUFtQixLQUFLTCxNQUFMLENBQVlNLElBQVosQ0FBaUIsSUFBakIsQ0FBbkIsRUFBMkMsR0FBM0MsQ0FBdEI7QUFDQSxpQkFBS1YsU0FBTCxDQUFlLFNBQWY7QUFDQTs7QUFDSixlQUFLLFNBQUw7QUFDSSxpQkFBS1csVUFBTCxHQUFrQixLQUFLSixjQUFMLEVBQWxCO0FBQ0EsaUJBQUtQLFNBQUwsQ0FBZSxRQUFmO0FBQ0E7O0FBQ0osZUFBSyxRQUFMO0FBQ0ksaUJBQUtDLFNBQUwsSUFBa0IsS0FBS00sY0FBTCxLQUF3QixLQUFLSSxVQUEvQztBQUNBLGlCQUFLWCxTQUFMLENBQWUsU0FBZjtBQUNBOztBQUNKLGVBQUssVUFBTDtBQUNJO0FBZlI7QUFpQkgsT0FyQ2dDO0FBc0NqQ08sTUFBQUEsY0FBYyxFQUFFLDBCQUFZO0FBQ3hCLGVBQVEsSUFBSUssSUFBSixFQUFELENBQWFDLE9BQWIsS0FBeUIsSUFBaEM7QUFDSCxPQXhDZ0M7QUF5Q2pDQyxNQUFBQSxNQUFNLEVBQUUsa0JBQVk7QUFDaEIsZUFBTzVCLEVBQUUsQ0FBQ0UsWUFBSCxDQUFnQjtBQUNuQjJCLFVBQUFBLElBQUksRUFBRSxLQURhO0FBRW5CQyxVQUFBQSxHQUFHLEVBQUUsQ0FBQyxZQUFELENBRmM7QUFHbkJDLFVBQUFBLFFBQVEsRUFBRSxDQUNOL0IsRUFBRSxDQUFDRSxZQUFILENBQWdCO0FBQ1oyQixZQUFBQSxJQUFJLEVBQUUsR0FETTtBQUVaQyxZQUFBQSxHQUFHLEVBQUUsWUFBWTtBQUNiLHNCQUFRLEtBQUtYLFNBQUwsRUFBUjtBQUNJLHFCQUFLLFNBQUw7QUFDSSx5QkFBTyxDQUFDLEtBQUQsRUFBUSxTQUFSLEVBQW1CLG1CQUFuQixDQUFQOztBQUNKLHFCQUFLLFNBQUw7QUFDSSx5QkFBTyxDQUFDLEtBQUQsRUFBUSxVQUFSLEVBQW9CLG1CQUFwQixDQUFQOztBQUNKLHFCQUFLLFFBQUw7QUFDSSx5QkFBTyxDQUFDLEtBQUQsRUFBUSxTQUFSLEVBQW1CLG1CQUFuQixDQUFQOztBQUNKLHFCQUFLLFVBQUw7QUFDSSx5QkFBTyxDQUFDLEtBQUQsRUFBUSxVQUFSLEVBQW9CLG1CQUFwQixDQUFQO0FBUlI7QUFVSCxhQVhJLENBV0hLLElBWEcsQ0FXRSxJQVhGLENBRk87QUFjWlEsWUFBQUEsS0FBSyxFQUFFLFlBQVk7QUFDZixtQkFBS2YsTUFBTDtBQUNILGFBRk0sQ0FFTE8sSUFGSyxDQUVBLElBRkE7QUFkSyxXQUFoQixDQURNLEVBbUJOeEIsRUFBRSxDQUFDRSxZQUFILENBQWdCO0FBQ1oyQixZQUFBQSxJQUFJLEVBQUUsR0FETTtBQUVaQyxZQUFBQSxHQUFHLEVBQUUsQ0FBQyxLQUFELEVBQVEsU0FBUixHQUFxQixrQkFBckIsQ0FGTztBQUdaRSxZQUFBQSxLQUFLLEVBQUUsWUFBWTtBQUNmLG1CQUFLckIsS0FBTDtBQUNILGFBRk0sQ0FFTGEsSUFGSyxDQUVBLElBRkE7QUFISyxXQUFoQixDQW5CTSxFQTBCTnhCLEVBQUUsQ0FBQ0UsWUFBSCxDQUFnQjtBQUNaMkIsWUFBQUEsSUFBSSxFQUFFLEtBRE07QUFFWkMsWUFBQUEsR0FBRyxFQUFFLENBQUMsaUJBQUQsQ0FGTztBQUdaRyxZQUFBQSxJQUFJLEVBQUUsWUFBWTtBQUNkLHFCQUFPLEtBQUtDLGNBQUwsRUFBUDtBQUNILGFBRkssQ0FFSlYsSUFGSSxDQUVDLElBRkQ7QUFITSxXQUFoQixDQTFCTTtBQUhTLFNBQWhCLENBQVA7QUFzQ0gsT0FoRmdDO0FBaUZqQ1csTUFBQUEsR0FBRyxFQUFFLGFBQVVDLEdBQVYsRUFBZUMsSUFBZixFQUFxQjtBQUN0QixZQUFJQyxDQUFDLEdBQUcsY0FBY0YsR0FBdEI7QUFDQSxlQUFPRSxDQUFDLENBQUNDLE1BQUYsQ0FBU0QsQ0FBQyxDQUFDRSxNQUFGLEdBQVdILElBQXBCLENBQVA7QUFDSCxPQXBGZ0M7QUFxRmpDbkIsTUFBQUEsTUFBTSxFQUFFLGtCQUFZO0FBQ2hCLFlBQUksS0FBS0MsU0FBTCxPQUFxQixTQUF6QixFQUFvQztBQUNoQztBQUNIOztBQUNELFlBQUlzQixXQUFXLEdBQUcsS0FBS3BCLGNBQUwsS0FBd0IsS0FBS0QsU0FBL0M7QUFDQSxZQUFJc0IsYUFBYSxHQUFHLEtBQUtuQyxRQUFMLEdBQWdCa0MsV0FBaEIsR0FBOEIsS0FBSzFCLFNBQXZEOztBQUNBLFlBQUkyQixhQUFhLElBQUksQ0FBckIsRUFBd0I7QUFDcEJBLFVBQUFBLGFBQWEsR0FBRyxDQUFoQjtBQUNBcEIsVUFBQUEsTUFBTSxDQUFDVCxhQUFQLENBQXFCLEtBQUtELGNBQTFCO0FBQ0EsZUFBS0EsY0FBTCxHQUFzQixJQUF0QjtBQUNBLGVBQUtFLFNBQUwsQ0FBZSxVQUFmOztBQUNBLGNBQUksS0FBS0osUUFBVCxFQUFtQjtBQUNmLGlCQUFLQSxRQUFMO0FBQ0g7QUFDSjs7QUFDRCxhQUFLTSxhQUFMLENBQW1CMEIsYUFBbkI7QUFDSCxPQXJHZ0M7O0FBc0dqQzFCLE1BQUFBLGFBQWEsQ0FBQzBCLGFBQUQsRUFBZ0I7QUFDekIsWUFBSUMsb0JBQW9CLEdBQUcsS0FBS1IsR0FBTCxDQUFTUyxJQUFJLENBQUNDLEtBQUwsQ0FBV0gsYUFBYSxHQUFHLEVBQTNCLENBQVQsRUFBeUMsQ0FBekMsQ0FBM0I7QUFDQSxZQUFJSSxvQkFBb0IsR0FBRyxLQUFLWCxHQUFMLENBQVNTLElBQUksQ0FBQ0MsS0FBTCxDQUFXSCxhQUFhLEdBQUdDLG9CQUFvQixHQUFHLEVBQWxELENBQVQsRUFBZ0UsQ0FBaEUsQ0FBM0I7QUFDQSxhQUFLSSxjQUFMLENBQW9CSixvQkFBb0IsR0FBRyxHQUF2QixHQUE2Qkcsb0JBQWpEO0FBQ0g7O0FBMUdnQyxLQUF2QjtBQUZMLEdBQWI7QUFpSEEsU0FBTzdDLE1BQVA7QUFFSCxDQXJISyxDQUFOIiwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFsnLi4vLi4vLi4vLi4vc3JjL2luZGV4J10sIGZ1bmN0aW9uICh0dCkge1xuXG4gICAgdmFyIG1vZHVsZSA9IHtcblxuICAgICAgICBjcmVhdGVUdE5vZGU6IHR0LmNyZWF0ZVR0Tm9kZUNyZWF0b3Ioe1xuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5taW51dGVzID0gcGFyYW1zLm1pbnV0ZXMgfHwgMDtcbiAgICAgICAgICAgICAgICB0aGlzLmR1cmF0aW9uID0gcGFyYW1zLm1pbnV0ZXMgKiA2MCArIHBhcmFtcy5zZWNvbmRzO1xuICAgICAgICAgICAgICAgIHR0LmluaXRQcm9wZXJ0eSh0aGlzLCAnZGlzcGxheVRpbWUnKTtcbiAgICAgICAgICAgICAgICB0dC5pbml0UHJvcGVydHkodGhpcywgJ3N0YXR1cycpO1xuICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWQgPSBwYXJhbXMuZmluaXNoZWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudXBkYXRlSW50ZXJ2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnVwZGF0ZUludGVydmFsKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVJbnRlcnZhbCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdHVzKCdpbml0aWFsJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXVzZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmR1cmF0aW9uKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5nZXRTdGF0dXMoKSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdpbml0aWFsJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdGhpcy5nZXRDdXJyZW50VGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVJbnRlcnZhbCA9IHdpbmRvdy5zZXRJbnRlcnZhbCh0aGlzLnVwZGF0ZS5iaW5kKHRoaXMpLCAxMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoJ3J1bm5pbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdydW5uaW5nJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGF1c2VTdGFydCA9IHRoaXMuZ2V0Q3VycmVudFRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdHVzKCdwYXVzZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdwYXVzZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXVzZVRpbWUgKz0gdGhpcy5nZXRDdXJyZW50VGltZSgpIC0gdGhpcy5wYXVzZVN0YXJ0O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoJ3J1bm5pbmcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdmaW5pc2hlZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q3VycmVudFRpbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAvIDEwMDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICBjc3M6IFsnc3RvcC13YXRjaCddLFxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy5nZXRTdGF0dXMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW5pdGlhbCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsnZmFzJywgJ2ZhLXBsYXknLCAnc3RvcC13YXRjaC10b2dnbGUnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3J1bm5pbmcnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbJ2ZhcycsICdmYS1wYXVzZScsICdzdG9wLXdhdGNoLXRvZ2dsZSddO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncGF1c2VkJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWydmYXMnLCAnZmEtcGxheScsICdzdG9wLXdhdGNoLXRvZ2dsZSddO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZmluaXNoZWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbJ2ZhcycsICdmYS1jaGVjaycsICdzdG9wLXdhdGNoLXRvZ2dsZSddO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2knLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzczogWydmYXMnLCAnZmEtdW5kbycsICwgJ3N0b3Atd2F0Y2gtcmVzZXQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ3N0b3Atd2F0Y2gtdGltZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGlzcGxheVRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYWQ6IGZ1bmN0aW9uIChudW0sIHNpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcyA9IFwiMDAwMDAwMDAwXCIgKyBudW07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHMuc3Vic3RyKHMubGVuZ3RoIC0gc2l6ZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0U3RhdHVzKCkgIT09ICdydW5uaW5nJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBlbGFwc2VkVGltZSA9IHRoaXMuZ2V0Q3VycmVudFRpbWUoKSAtIHRoaXMuc3RhcnRUaW1lO1xuICAgICAgICAgICAgICAgIHZhciByZW1haW5pbmdUaW1lID0gdGhpcy5kdXJhdGlvbiAtIGVsYXBzZWRUaW1lICsgdGhpcy5wYXVzZVRpbWU7XG4gICAgICAgICAgICAgICAgaWYgKHJlbWFpbmluZ1RpbWUgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdUaW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy51cGRhdGVJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSW50ZXJ2YWwgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cygnZmluaXNoZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmluaXNoZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluaXNoZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURpc3BsYXkocmVtYWluaW5nVGltZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlRGlzcGxheShyZW1haW5pbmdUaW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlbWFpbmluZ1RpbWVNaW51dGVzID0gdGhpcy5wYWQoTWF0aC5mbG9vcihyZW1haW5pbmdUaW1lIC8gNjApLCAyKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVtYWluaW5nVGltZVNlY29uZHMgPSB0aGlzLnBhZChNYXRoLmZsb29yKHJlbWFpbmluZ1RpbWUgLSByZW1haW5pbmdUaW1lTWludXRlcyAqIDYwKSwgMik7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXREaXNwbGF5VGltZShyZW1haW5pbmdUaW1lTWludXRlcyArICc6JyArIHJlbWFpbmluZ1RpbWVTZWNvbmRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgIH07XG5cbiAgICByZXR1cm4gbW9kdWxlO1xuXG59KTtcbiJdfQ==