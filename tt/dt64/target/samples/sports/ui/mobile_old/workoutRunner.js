"use strict";

define(['../../../../src/index', './stopWatch', '../common/time'], function (tt, stopWatch, time) {
  var module = {};
  module.createWorkoutItemTtNode = tt.createTtNodeCreator({
    init: function init(params) {
      this.item = params.item;
      tt.initProperty(this.item, 'count');
      tt.initProperty(this.item, 'duration');
      tt.initProperty(this.item, 'exercise');
      this.checked = false;
      tt.initProperty(this, 'checked');
    },
    createLine1: function createLine1() {
      return tt.createTtNode({
        type: 'div',
        css: ['workout-runner-item-line1'],
        children: [tt.createTtNode({
          type: 'div',
          css: ['workout-runner-item-line1-exercise-name'],
          text: function () {
            return this.item.getExercise().getName();
          }.bind(this)
        }), tt.createTtNode({
          type: 'div',
          css: ['workout-runner-item-line1-name'],
          text: function () {
            return this.item.getName();
          }.bind(this)
        })]
      });
    },
    createLine2: function createLine2() {
      var children = [];
      children.push(tt.createTtNode({
        type: 'div',
        css: ['workout-runner-item-line2-count'],
        text: '' + this.item.getCount() + 'x'
      }));

      if (this.item.getCount() === 1) {
        children.push(tt.createTtNode({
          type: 'div',
          css: ['workout-runner-item-line2-stop-watch'],
          children: [stopWatch.createTtNode({
            seconds: this.item.getDuration(),
            finished: function finished() {
              navigator && navigator.notification && navigator.notification.beep(1);
            }
          })]
        }));
      } else {
        children.push(tt.createTtNode({
          type: 'div',
          css: ['workout-runner-item-line2-stop-watch'],
          text: function () {
            return time.int2ext(this.item.getDuration());
          }.bind(this)
        }));
      }

      return tt.createTtNode({
        type: 'div',
        css: ['workout-runner-item-line2'],
        children: children
      });
    },
    render: function render() {
      return tt.createTtNode({
        type: 'div',
        data: this,
        css: function () {
          if (this.getChecked()) {
            return ['workout-runner-item', 'workout-runner-item-checked'];
          } else {
            return ['workout-runner-item'];
          }
        }.bind(this),
        children: [tt.createTtNode({
          type: 'i',
          css: function () {
            var checked = this.getChecked();

            if (checked) {
              return ['fas', 'fa-check-square', 'workout-runner-item-checkbox'];
            } else {
              return ['fas', 'fa-square', 'workout-runner-item-checkbox'];
            }
          }.bind(this),
          click: function () {
            var checked = this.getChecked();
            this.setChecked(!checked);
          }.bind(this)
        }), tt.createTtNode({
          type: 'div',
          css: ['workout-runner-item-line-container'],
          children: [this.createLine1(), this.createLine2()]
        })]
      });
    }
  });
  module.createTtNode = tt.createTtNodeCreator({
    init: function init(params) {
      this.mobileUi = params.mobileUi;
      this.workout = params.workout;
    },
    render: function render() {
      var children = tt.createMappedList(this.workout.items, function (item) {
        return module.createWorkoutItemTtNode({
          item: item
        });
      });
      tt.createReducedListProperty(this, 'elapsedTime', children, function (accu, item) {
        return accu + (item.data.getChecked() ? item.data.item.getTotalDuration() : 0);
      }, 0);
      return tt.createTtNode({
        type: 'div',
        children: [tt.createTtNode({
          type: 'div',
          css: ['workout-runner-header-container'],
          children: [tt.createTtNode({
            type: 'div',
            css: ['workout-runner-header'],
            children: [tt.createTtNode({
              type: 'i',
              css: ['fas', 'fa-arrow-left'],
              click: function () {
                this.mobileUi.showWorkout(this.workout.parent);
              }.bind(this)
            }), tt.createTtNode({
              type: 'div',
              css: ['workout-runner-header-text'],
              text: this.workout.getName()
            })]
          }), tt.createTtNode({
            type: 'div',
            css: ['workout-runner-subheader'],
            text: function () {
              var elapsedTime = this.getElapsedTime();
              var totalDuration = this.workout.getTotalDuration();
              var remainingTime = totalDuration - elapsedTime;
              var percentage = Math.floor(elapsedTime / totalDuration * 100);
              return percentage + '% - ' + time.int2ext(remainingTime);
            }.bind(this)
          })]
        }), tt.createTtNode({
          type: 'div',
          css: ['workout-runner-items'],
          children: children
        })]
      });
    }
  });
  return module;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NhbXBsZXMvc3BvcnRzL3VpL21vYmlsZV9vbGQvd29ya291dFJ1bm5lci5qcyJdLCJuYW1lcyI6WyJkZWZpbmUiLCJ0dCIsInN0b3BXYXRjaCIsInRpbWUiLCJtb2R1bGUiLCJjcmVhdGVXb3Jrb3V0SXRlbVR0Tm9kZSIsImNyZWF0ZVR0Tm9kZUNyZWF0b3IiLCJpbml0IiwicGFyYW1zIiwiaXRlbSIsImluaXRQcm9wZXJ0eSIsImNoZWNrZWQiLCJjcmVhdGVMaW5lMSIsImNyZWF0ZVR0Tm9kZSIsInR5cGUiLCJjc3MiLCJjaGlsZHJlbiIsInRleHQiLCJnZXRFeGVyY2lzZSIsImdldE5hbWUiLCJiaW5kIiwiY3JlYXRlTGluZTIiLCJwdXNoIiwiZ2V0Q291bnQiLCJzZWNvbmRzIiwiZ2V0RHVyYXRpb24iLCJmaW5pc2hlZCIsIm5hdmlnYXRvciIsIm5vdGlmaWNhdGlvbiIsImJlZXAiLCJpbnQyZXh0IiwicmVuZGVyIiwiZGF0YSIsImdldENoZWNrZWQiLCJjbGljayIsInNldENoZWNrZWQiLCJtb2JpbGVVaSIsIndvcmtvdXQiLCJjcmVhdGVNYXBwZWRMaXN0IiwiaXRlbXMiLCJjcmVhdGVSZWR1Y2VkTGlzdFByb3BlcnR5IiwiYWNjdSIsImdldFRvdGFsRHVyYXRpb24iLCJzaG93V29ya291dCIsInBhcmVudCIsImVsYXBzZWRUaW1lIiwiZ2V0RWxhcHNlZFRpbWUiLCJ0b3RhbER1cmF0aW9uIiwicmVtYWluaW5nVGltZSIsInBlcmNlbnRhZ2UiLCJNYXRoIiwiZmxvb3IiXSwibWFwcGluZ3MiOiI7O0FBQUFBLE1BQU0sQ0FBQyxDQUFDLHVCQUFELEVBQTBCLGFBQTFCLEVBQXlDLGdCQUF6QyxDQUFELEVBQTZELFVBQVVDLEVBQVYsRUFBY0MsU0FBZCxFQUF5QkMsSUFBekIsRUFBK0I7QUFFOUYsTUFBSUMsTUFBTSxHQUFHLEVBQWI7QUFFQUEsRUFBQUEsTUFBTSxDQUFDQyx1QkFBUCxHQUFpQ0osRUFBRSxDQUFDSyxtQkFB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QUNZLFlBQUgsQ0FBZ0I7QUFDWkMsWUFBQUEsSUFBSSxFQUFFLEtBRE07QUFFWkMsWUFBQUEsR0FBRyxFQUFFLENBQUMsMEJBQUQsQ0FGTztBQUdaRSxZQUFBQSxJQUFJLEVBQUUsWUFBWTtBQUNkLGtCQUFJNEIsV0FBVyxHQUFHLEtBQUtDLGNBQUwsRUFBbEI7QUFDQSxrQkFBSUMsYUFBYSxHQUFHLEtBQUtWLE9BQUwsQ0FBYUssZ0JBQWIsRUFBcEI7QUFDQSxrQkFBSU0sYUFBYSxHQUFHRCxhQUFhLEdBQUdGLFdBQXBDO0FBQ0Esa0JBQUlJLFVBQVUsR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVdOLFdBQVcsR0FBR0UsYUFBZCxHQUE4QixHQUF6QyxDQUFqQjtBQUNBLHFCQUFPRSxVQUFVLEdBQUcsTUFBYixHQUFzQjlDLElBQUksQ0FBQzJCLE9BQUwsQ0FBYWtCLGFBQWIsQ0FBN0I7QUFDSCxhQU5LLENBTUo1QixJQU5JLENBTUMsSUFORDtBQUhNLFdBQWhCLENBbEJNO0FBSEUsU0FBaEIsQ0FETSxFQW1DTm5CLEVBQUUsQ0FBQ1ksWUFBSCxDQUFnQjtBQUNaQyxVQUFBQSxJQUFJLEVBQUUsS0FETTtBQUVaQyxVQUFBQSxHQUFHLEVBQUUsQ0FBQyxzQkFBRCxDQUZPO0FBR1pDLFVBQUFBLFFBQVEsRUFBRUE7QUFIRSxTQUFoQixDQW5DTTtBQUZTLE9BQWhCLENBQVA7QUE0Q0g7QUF4RHdDLEdBQXZCLENBQXRCO0FBMkRBLFNBQU9aLE1BQVA7QUFFSCxDQXpLSyxDQUFOIiwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFsnLi4vLi4vLi4vLi4vc3JjL2luZGV4JywgJy4vc3RvcFdhdGNoJywgJy4uL2NvbW1vbi90aW1lJ10sIGZ1bmN0aW9uICh0dCwgc3RvcFdhdGNoLCB0aW1lKSB7XG5cbiAgICB2YXIgbW9kdWxlID0ge307XG5cbiAgICBtb2R1bGUuY3JlYXRlV29ya291dEl0ZW1UdE5vZGUgPSB0dC5jcmVhdGVUdE5vZGVDcmVhdG9yKHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgdGhpcy5pdGVtID0gcGFyYW1zLml0ZW07XG4gICAgICAgICAgICB0dC5pbml0UHJvcGVydHkodGhpcy5pdGVtLCAnY291bnQnKTtcbiAgICAgICAgICAgIHR0LmluaXRQcm9wZXJ0eSh0aGlzLml0ZW0sICdkdXJhdGlvbicpO1xuICAgICAgICAgICAgdHQuaW5pdFByb3BlcnR5KHRoaXMuaXRlbSwgJ2V4ZXJjaXNlJyk7XG4gICAgICAgICAgICB0aGlzLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHR0LmluaXRQcm9wZXJ0eSh0aGlzLCAnY2hlY2tlZCcpO1xuICAgICAgICB9LFxuICAgICAgICBjcmVhdGVMaW5lMTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgY3NzOiBbJ3dvcmtvdXQtcnVubmVyLWl0ZW0tbGluZTEnXSxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAgICAgICAgICB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3M6IFsnd29ya291dC1ydW5uZXItaXRlbS1saW5lMS1leGVyY2lzZS1uYW1lJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlbS5nZXRFeGVyY2lzZSgpLmdldE5hbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ3dvcmtvdXQtcnVubmVyLWl0ZW0tbGluZTEtbmFtZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLml0ZW0uZ2V0TmFtZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlTGluZTI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IFtdO1xuICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgIGNzczogWyd3b3Jrb3V0LXJ1bm5lci1pdGVtLWxpbmUyLWNvdW50J10sXG4gICAgICAgICAgICAgICAgdGV4dDogJycgKyB0aGlzLml0ZW0uZ2V0Q291bnQoKSArICd4J1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbS5nZXRDb3VudCgpID09PSAxKSB7XG4gICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ3dvcmtvdXQtcnVubmVyLWl0ZW0tbGluZTItc3RvcC13YXRjaCddLFxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW3N0b3BXYXRjaC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kczogdGhpcy5pdGVtLmdldER1cmF0aW9uKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBmaW5pc2hlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRvciAmJiBuYXZpZ2F0b3Iubm90aWZpY2F0aW9uICYmIG5hdmlnYXRvci5ub3RpZmljYXRpb24uYmVlcCgxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSldXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICBjc3M6IFsnd29ya291dC1ydW5uZXItaXRlbS1saW5lMi1zdG9wLXdhdGNoJ10sXG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aW1lLmludDJleHQodGhpcy5pdGVtLmdldER1cmF0aW9uKCkpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JyxcbiAgICAgICAgICAgICAgICBjc3M6IFsnd29ya291dC1ydW5uZXItaXRlbS1saW5lMiddLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHJldHVybiB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHRoaXMsXG4gICAgICAgICAgICAgICAgY3NzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldENoZWNrZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsnd29ya291dC1ydW5uZXItaXRlbScsICd3b3Jrb3V0LXJ1bm5lci1pdGVtLWNoZWNrZWQnXTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbJ3dvcmtvdXQtcnVubmVyLWl0ZW0nXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAgICAgICAgICB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2knLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSB0aGlzLmdldENoZWNrZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWydmYXMnLCAnZmEtY2hlY2stc3F1YXJlJywgJ3dvcmtvdXQtcnVubmVyLWl0ZW0tY2hlY2tib3gnXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbJ2ZhcycsICdmYS1zcXVhcmUnLCAnd29ya291dC1ydW5uZXItaXRlbS1jaGVja2JveCddO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSB0aGlzLmdldENoZWNrZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldENoZWNrZWQoIWNoZWNrZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICBjc3M6IFsnd29ya291dC1ydW5uZXItaXRlbS1saW5lLWNvbnRhaW5lciddLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUxpbmUxKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVMaW5lMigpXVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBtb2R1bGUuY3JlYXRlVHROb2RlID0gdHQuY3JlYXRlVHROb2RlQ3JlYXRvcih7XG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgIHRoaXMubW9iaWxlVWkgPSBwYXJhbXMubW9iaWxlVWk7XG4gICAgICAgICAgICB0aGlzLndvcmtvdXQgPSBwYXJhbXMud29ya291dDtcbiAgICAgICAgfSxcbiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSB0dC5jcmVhdGVNYXBwZWRMaXN0KHRoaXMud29ya291dC5pdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9kdWxlLmNyZWF0ZVdvcmtvdXRJdGVtVHROb2RlKHsgaXRlbTogaXRlbSB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdHQuY3JlYXRlUmVkdWNlZExpc3RQcm9wZXJ0eSh0aGlzLCAnZWxhcHNlZFRpbWUnLCBjaGlsZHJlbiwgZnVuY3Rpb24gKGFjY3UsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWNjdSArIChpdGVtLmRhdGEuZ2V0Q2hlY2tlZCgpID8gaXRlbS5kYXRhLml0ZW0uZ2V0VG90YWxEdXJhdGlvbigpIDogMCk7XG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIHJldHVybiB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXG4gICAgICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzczogWyd3b3Jrb3V0LXJ1bm5lci1oZWFkZXItY29udGFpbmVyJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3M6IFsnd29ya291dC1ydW5uZXItaGVhZGVyJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3M6IFsnZmFzJywgJ2ZhLWFycm93LWxlZnQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vYmlsZVVpLnNob3dXb3Jrb3V0KHRoaXMud29ya291dC5wYXJlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3M6IFsnd29ya291dC1ydW5uZXItaGVhZGVyLXRleHQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLndvcmtvdXQuZ2V0TmFtZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ3dvcmtvdXQtcnVubmVyLXN1YmhlYWRlciddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxhcHNlZFRpbWUgPSB0aGlzLmdldEVsYXBzZWRUaW1lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG90YWxEdXJhdGlvbiA9IHRoaXMud29ya291dC5nZXRUb3RhbER1cmF0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVtYWluaW5nVGltZSA9IHRvdGFsRHVyYXRpb24gLSBlbGFwc2VkVGltZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwZXJjZW50YWdlID0gTWF0aC5mbG9vcihlbGFwc2VkVGltZSAvIHRvdGFsRHVyYXRpb24gKiAxMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlcmNlbnRhZ2UgKyAnJSAtICcgKyB0aW1lLmludDJleHQocmVtYWluaW5nVGltZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ3dvcmtvdXQtcnVubmVyLWl0ZW1zJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbW9kdWxlO1xuXG59KTtcbiJdfQ==