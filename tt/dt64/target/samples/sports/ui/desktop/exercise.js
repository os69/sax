"use strict";

define(['../../../../src/index', '../../../../controls/util', '../../model/Exercise', '../../model/Movement', '../common/icons', './movement'], function (tt, controlsUtil, Exercise, Movement, icons, movementUi) {
  var module = {};

  module.createExerciseBasicDetailTtNode = function (params) {
    tt.initProperty(params.exerciseBasic, 'helpUrl');
    return tt.createTtNode({
      type: 'div',
      children: [controlsUtil.createInputTtNode({
        label: 'name',
        value: function value() {
          return params.exerciseBasic.getName();
        },
        change: function change(event) {
          params.exerciseBasic.setName(event.srcElement.value);
        }
      }), controlsUtil.createInputTtNode({
        label: 'help url',
        value: function value() {
          return params.exerciseBasic.getHelpUrl();
        },
        change: function change(event) {
          params.exerciseBasic.setHelpUrl(event.srcElement.value);
        }
      })]
    });
  };

  module.createExerciseTreeNode = function (params) {
    if (params.exercise.exercises) {
      return module.createExerciseCollectionTreeNode(params);
    } else {
      return module.createExerciseBasicTreeNode(params);
    }
  };

  module.createExerciseCollectionTreeNode = function (params) {
    tt.initProperty(params.exercise, 'name');
    return {
      exercise: params.exercise,
      labelTtNodes: [controlsUtil.createIconTtNode({
        icon: icons.ExerciseCollection
      }), tt.createTtNode({
        type: 'input',
        css: ['name-input'],
        value: function value() {
          return params.exercise.getName();
        },
        change: function change(event) {
          params.exercise.setName(event.srcElement.value);
        }
      }), controlsUtil.createIconTtNode({
        click: function () {
          params.exercise.createExerciseCollection({
            name: 'New Collection'
          });
        }.bind(this),
        icon: icons.createExerciseCollection
      }), controlsUtil.createIconTtNode({
        click: function () {
          params.exercise.createExerciseBasic({
            name: 'New Exercise'
          });
        }.bind(this),
        icon: icons.ExerciseBasic
      }), controlsUtil.createIconTtNode({
        click: function () {
          params.exercise.delete();
        }.bind(this),
        icon: ['fas', 'fa-trash-alt']
      })],
      childNodes: tt.createMappedList(params.exercise.exercises, function (exercise) {
        return module.createExerciseTreeNode(tt.core.cloneExtend(params, {
          exercise: exercise
        }));
      }),
      drop: function drop(droppedTreeNode) {
        if (droppedTreeNode.exercise instanceof Exercise) {
          params.exercise.insertBefore(droppedTreeNode.exercise);
          return;
        }
      }
    };
  };

  module.createExerciseBasicTreeNode = function (params) {
    tt.initProperty(params.exercise, 'name');
    return {
      exercise: params.exercise,
      labelTtNodes: [controlsUtil.createIconTtNode({
        icon: icons.ExerciseBasic
      }), tt.createTtNode({
        type: 'input',
        css: ['name-input'],
        value: function value() {
          return params.exercise.getName();
        },
        change: function change(event) {
          params.exercise.setName(event.srcElement.value);
        },
        click: function click() {
          params.ui.setDetail(params.exercise);
        }
      }), controlsUtil.createIconTtNode({
        click: function () {
          params.exercise.delete();
        }.bind(this),
        icon: ['fas', 'fa-trash-alt']
      })],
      childNodes: tt.createMappedList(params.exercise.movements, function (movement) {
        //return module.createExerciseMovementUsageTreeNode(tt.core.cloneExtend(params, { movement: movement }));
        return movementUi.createMovementTreeNode(tt.core.cloneExtend(params, {
          movement: movement
        }));
      }),
      drop: function drop(droppedTreeNode) {
        if (droppedTreeNode.exercise instanceof Exercise) {
          params.exercise.insertBefore(droppedTreeNode.exercise);
          return;
        }

        if (droppedTreeNode.movement instanceof Movement) {
          params.exercise.addMovement(droppedTreeNode.movement);
          return;
        }
      }
    };
  };

  module.createExerciseMovementUsageTreeNode = function (params) {
    tt.initProperty(params.movement, 'name');
    return {
      exercise: params.exercise,
      movement: params.movement,
      labelTtNodes: [controlsUtil.createIconTtNode({
        icon: icons.MovementBasic
      }), tt.createTtNode({
        type: 'span',
        css: ['name-input'],
        text: function text() {
          return params.movement.getName();
        }
      }), controlsUtil.createIconTtNode({
        click: function () {
          params.exercise.removeMovement(params.movement);
        }.bind(this),
        icon: ['fas', 'fa-trash-alt']
      })],
      childNodes: []
    };
  };

  return module;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NhbXBsZXMvc3BvcnRzL3VpL2Rlc2t0b3AvZXhlcmNpc2UuanMiXSwibmFtZXMiOlsiZGVmaW5lIiwidHQiLCJjb250cm9sc1V0aWwiLCJFeGVyY2lzZSIsIk1vdmVtZW50IiwiaWNvbnMiLCJtb3ZlbWVudFVpIiwibW9kdWxlIiwiY3JlYXRlRXhlcmNpc2VCYXNpY0RldGFpbFR0Tm9kZSIsInBhcmFtcyIsImluaXRQcm9wZXJ0eSIsImV4ZXJjaXNlQmFzaWMiLCJjcmVhdGVUdE5vZGUiLCJ0eXBlIiwiY2hpbGRyZW4iLCJjcmVhdGVJbnB1dFR0Tm9kZSIsImxhYmVsIiwidmFsdWUiLCJnZXROYW1lIiwiY2hhbmdlIiwiZXZlbnQiLCJzZXROYW1lIiwic3JjRWxlbWVudCIsImdldEhlbHBVcmwiLCJzZXRIZWxwVXJsIiwiY3JlYXRlRXhlcmNpc2VUcmVlTm9kZSIsImV4ZXJjaXNlIiwiZXhlcmNpc2VzIiwiY3JlYXRlRXhlcmNpc2VDb2xsZWN0aW9uVHJlZU5vZGUiLCJjcmVhdGVFeGVyY2lzZUJhc2ljVHJlZU5vZGUiLCJsYWJlbFR0Tm9kZXMiLCJjcmVhdGVJY29uVHROb2RlIiwiaWNvbiIsIkV4ZXJjaXNlQ29sbGVjdGlvbiIsImNzcyIsImNsaWNrIiwiY3JlYXRlRXhlcmNpc2VDb2xsZWN0aW9uIiwibmFtZSIsImJpbmQiLCJjcmVhdGVFeGVyY2lzZUJhc2ljIiwiRXhlcmNpc2VCYXNpYyIsImRlbGV0ZSIsImNoaWxkTm9kZXMiLCJjcmVhdGVNYXBwZWRMaXN0IiwiY29yZSIsImNsb25lRXh0ZW5kIiwiZHJvcCIsImRyb3BwZWRUcmVlTm9kZSIsImluc2VydEJlZm9yZSIsInVpIiwic2V0RGV0YWlsIiwibW92ZW1lbnRzIiwibW92ZW1lbnQiLCJjcmVhdGVNb3ZlbWVudFRyZWVOb2RlIiwiYWRkTW92ZW1lbnQiLCJjcmVhdGVFeGVyY2lzZU1vdmVtZW50VXNhZ2VUcmVlTm9kZSIsIk1vdmVtZW50QmFzaWMiLCJ0ZXh0Iiwi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QUFBQSxNQUFNLENBQUNnRCxtQ0FBUCxHQUE2QyxVQUFVOUMsTUFBVixFQUFrQjtBQUMzRFIsSUFBQUEsRUFBRSxDQUFDUyxZQUFILENBQWdCRCxNQUFNLENBQUMyQyxRQUF2QixFQUFpQyxNQUFqQztBQUNBLFdBQU87QUFDSDFCLE1BQUFBLFFBQVEsRUFBRWpCLE1BQU0sQ0FBQ2lCLFFBRGQ7QUFFSDBCLE1BQUFBLFFBQVEsRUFBRTNDLE1BQU0sQ0FBQzJDLFFBRmQ7QUFHSHRCLE1BQUFBLFlBQVksRUFBRSxDQUNWNUIsWUFBWSxDQUFDNkIsZ0JBQWIsQ0FBOEI7QUFDMUJDLFFBQUFBLElBQUksRUFBRTNCLEtBQUssQ0FBQ21EO0FBRGMsT0FBOUIsQ0FEVSxFQUlWdkQsRUFBRSxDQUFDVyxZQUFILENBQWdCO0FBQ1pDLFFBQUFBLElBQUksRUFBRSxNQURNO0FBRVpxQixRQUFBQSxHQUFHLEVBQUUsQ0FBQyxZQUFELENBRk87QUFHWnVCLFFBQUFBLElBQUksRUFBRSxnQkFBWTtBQUFFLGlCQUFPaEQsTUFBTSxDQUFDMkMsUUFBUCxDQUFnQmxDLE9BQWhCLEVBQVA7QUFBbUM7QUFIM0MsT0FBaEIsQ0FKVSxFQVNWaEIsWUFBWSxDQUFDNkIsZ0JBQWIsQ0FBOEI7QUFDMUJJLFFBQUFBLEtBQUssRUFBRSxZQUFZO0FBQ2YxQixVQUFBQSxNQUFNLENBQUNpQixRQUFQLENBQWdCZ0MsY0FBaEIsQ0FBK0JqRCxNQUFNLENBQUMyQyxRQUF0QztBQUNILFNBRk0sQ0FFTGQsSUFGSyxDQUVBLElBRkEsQ0FEbUI7QUFJMUJOLFFBQUFBLElBQUksRUFBRSxDQUFDLEtBQUQsRUFBUSxjQUFSO0FBSm9CLE9BQTlCLENBVFUsQ0FIWDtBQW1CSFUsTUFBQUEsVUFBVSxFQUFFO0FBbkJULEtBQVA7QUFxQkgsR0F2QkQ7O0FBeUJBLFNBQU9uQyxNQUFQO0FBRUgsQ0E3SkssQ0FBTiIsInNvdXJjZXNDb250ZW50IjpbImRlZmluZShbJy4uLy4uLy4uLy4uL3NyYy9pbmRleCcsICcuLi8uLi8uLi8uLi9jb250cm9scy91dGlsJywgJy4uLy4uL21vZGVsL0V4ZXJjaXNlJywgJy4uLy4uL21vZGVsL01vdmVtZW50JywgJy4uL2NvbW1vbi9pY29ucycsJy4vbW92ZW1lbnQnXSwgZnVuY3Rpb24gKHR0LCBjb250cm9sc1V0aWwsIEV4ZXJjaXNlLCBNb3ZlbWVudCwgaWNvbnMsIG1vdmVtZW50VWkpIHtcblxuICAgIHZhciBtb2R1bGUgPSB7fTtcblxuICAgIG1vZHVsZS5jcmVhdGVFeGVyY2lzZUJhc2ljRGV0YWlsVHROb2RlID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB0dC5pbml0UHJvcGVydHkocGFyYW1zLmV4ZXJjaXNlQmFzaWMsICdoZWxwVXJsJyk7XG4gICAgICAgIHJldHVybiB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAgICAgIGNvbnRyb2xzVXRpbC5jcmVhdGVJbnB1dFR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnbmFtZScsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW1zLmV4ZXJjaXNlQmFzaWMuZ2V0TmFtZSgpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmV4ZXJjaXNlQmFzaWMuc2V0TmFtZShldmVudC5zcmNFbGVtZW50LnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xzVXRpbC5jcmVhdGVJbnB1dFR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnaGVscCB1cmwnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5leGVyY2lzZUJhc2ljLmdldEhlbHBVcmwoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy5leGVyY2lzZUJhc2ljLnNldEhlbHBVcmwoZXZlbnQuc3JjRWxlbWVudC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgbW9kdWxlLmNyZWF0ZUV4ZXJjaXNlVHJlZU5vZGUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIGlmIChwYXJhbXMuZXhlcmNpc2UuZXhlcmNpc2VzKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmNyZWF0ZUV4ZXJjaXNlQ29sbGVjdGlvblRyZWVOb2RlKHBhcmFtcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmNyZWF0ZUV4ZXJjaXNlQmFzaWNUcmVlTm9kZShwYXJhbXMpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIG1vZHVsZS5jcmVhdGVFeGVyY2lzZUNvbGxlY3Rpb25UcmVlTm9kZSA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdHQuaW5pdFByb3BlcnR5KHBhcmFtcy5leGVyY2lzZSwgJ25hbWUnKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGV4ZXJjaXNlOiBwYXJhbXMuZXhlcmNpc2UsXG4gICAgICAgICAgICBsYWJlbFR0Tm9kZXM6IFtcbiAgICAgICAgICAgICAgICBjb250cm9sc1V0aWwuY3JlYXRlSWNvblR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIGljb246IGljb25zLkV4ZXJjaXNlQ29sbGVjdGlvblxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgICAgICAgICAgIGNzczogWyduYW1lLWlucHV0J10sXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBwYXJhbXMuZXhlcmNpc2UuZ2V0TmFtZSgpOyB9LFxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmV4ZXJjaXNlLnNldE5hbWUoZXZlbnQuc3JjRWxlbWVudC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjb250cm9sc1V0aWwuY3JlYXRlSWNvblR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMuZXhlcmNpc2UuY3JlYXRlRXhlcmNpc2VDb2xsZWN0aW9uKHsgbmFtZTogJ05ldyBDb2xsZWN0aW9uJyB9KVxuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIGljb246IGljb25zLmNyZWF0ZUV4ZXJjaXNlQ29sbGVjdGlvblxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xzVXRpbC5jcmVhdGVJY29uVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy5leGVyY2lzZS5jcmVhdGVFeGVyY2lzZUJhc2ljKHsgbmFtZTogJ05ldyBFeGVyY2lzZScgfSlcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBpY29ucy5FeGVyY2lzZUJhc2ljXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY29udHJvbHNVdGlsLmNyZWF0ZUljb25UdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmV4ZXJjaXNlLmRlbGV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIGljb246IFsnZmFzJywgJ2ZhLXRyYXNoLWFsdCddXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBjaGlsZE5vZGVzOiB0dC5jcmVhdGVNYXBwZWRMaXN0KHBhcmFtcy5leGVyY2lzZS5leGVyY2lzZXMsIGZ1bmN0aW9uIChleGVyY2lzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2R1bGUuY3JlYXRlRXhlcmNpc2VUcmVlTm9kZSh0dC5jb3JlLmNsb25lRXh0ZW5kKHBhcmFtcywgeyBleGVyY2lzZTogZXhlcmNpc2UgfSkpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBkcm9wOiBmdW5jdGlvbiAoZHJvcHBlZFRyZWVOb2RlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRyb3BwZWRUcmVlTm9kZS5leGVyY2lzZSBpbnN0YW5jZW9mIEV4ZXJjaXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5leGVyY2lzZS5pbnNlcnRCZWZvcmUoZHJvcHBlZFRyZWVOb2RlLmV4ZXJjaXNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH07XG5cbiAgICBtb2R1bGUuY3JlYXRlRXhlcmNpc2VCYXNpY1RyZWVOb2RlID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB0dC5pbml0UHJvcGVydHkocGFyYW1zLmV4ZXJjaXNlLCAnbmFtZScpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZXhlcmNpc2U6IHBhcmFtcy5leGVyY2lzZSxcbiAgICAgICAgICAgIGxhYmVsVHROb2RlczogW1xuICAgICAgICAgICAgICAgIGNvbnRyb2xzVXRpbC5jcmVhdGVJY29uVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogaWNvbnMuRXhlcmNpc2VCYXNpY1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgICAgICAgICAgICAgIGNzczogWyduYW1lLWlucHV0J10sXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBwYXJhbXMuZXhlcmNpc2UuZ2V0TmFtZSgpOyB9LFxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmV4ZXJjaXNlLnNldE5hbWUoZXZlbnQuc3JjRWxlbWVudC52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMudWkuc2V0RGV0YWlsKHBhcmFtcy5leGVyY2lzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY29udHJvbHNVdGlsLmNyZWF0ZUljb25UdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmV4ZXJjaXNlLmRlbGV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIGljb246IFsnZmFzJywgJ2ZhLXRyYXNoLWFsdCddXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBjaGlsZE5vZGVzOiB0dC5jcmVhdGVNYXBwZWRMaXN0KHBhcmFtcy5leGVyY2lzZS5tb3ZlbWVudHMsIGZ1bmN0aW9uIChtb3ZlbWVudCkge1xuICAgICAgICAgICAgICAgIC8vcmV0dXJuIG1vZHVsZS5jcmVhdGVFeGVyY2lzZU1vdmVtZW50VXNhZ2VUcmVlTm9kZSh0dC5jb3JlLmNsb25lRXh0ZW5kKHBhcmFtcywgeyBtb3ZlbWVudDogbW92ZW1lbnQgfSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBtb3ZlbWVudFVpLmNyZWF0ZU1vdmVtZW50VHJlZU5vZGUodHQuY29yZS5jbG9uZUV4dGVuZChwYXJhbXMsIHsgbW92ZW1lbnQ6IG1vdmVtZW50IH0pKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZHJvcDogZnVuY3Rpb24gKGRyb3BwZWRUcmVlTm9kZSkge1xuICAgICAgICAgICAgICAgIGlmIChkcm9wcGVkVHJlZU5vZGUuZXhlcmNpc2UgaW5zdGFuY2VvZiBFeGVyY2lzZSkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuZXhlcmNpc2UuaW5zZXJ0QmVmb3JlKGRyb3BwZWRUcmVlTm9kZS5leGVyY2lzZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRyb3BwZWRUcmVlTm9kZS5tb3ZlbWVudCBpbnN0YW5jZW9mIE1vdmVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5leGVyY2lzZS5hZGRNb3ZlbWVudChkcm9wcGVkVHJlZU5vZGUubW92ZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBtb2R1bGUuY3JlYXRlRXhlcmNpc2VNb3ZlbWVudFVzYWdlVHJlZU5vZGUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHR0LmluaXRQcm9wZXJ0eShwYXJhbXMubW92ZW1lbnQsICduYW1lJyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBleGVyY2lzZTogcGFyYW1zLmV4ZXJjaXNlLFxuICAgICAgICAgICAgbW92ZW1lbnQ6IHBhcmFtcy5tb3ZlbWVudCxcbiAgICAgICAgICAgIGxhYmVsVHROb2RlczogW1xuICAgICAgICAgICAgICAgIGNvbnRyb2xzVXRpbC5jcmVhdGVJY29uVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogaWNvbnMuTW92ZW1lbnRCYXNpY1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzcGFuJyxcbiAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ25hbWUtaW5wdXQnXSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogZnVuY3Rpb24gKCkgeyByZXR1cm4gcGFyYW1zLm1vdmVtZW50LmdldE5hbWUoKTsgfVxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xzVXRpbC5jcmVhdGVJY29uVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy5leGVyY2lzZS5yZW1vdmVNb3ZlbWVudChwYXJhbXMubW92ZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIGljb246IFsnZmFzJywgJ2ZhLXRyYXNoLWFsdCddXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBjaGlsZE5vZGVzOiBbXVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICByZXR1cm4gbW9kdWxlO1xuXG59KTtcbiJdfQ==