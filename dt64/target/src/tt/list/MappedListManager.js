"use strict";

define(['../../core/core', '../../core/event', './ListManager', '../property/CalculatedProperty'], function (core, event, ListManager, CalculatedProperty) {
  return core.defineDerivedClass(ListManager, {
    init: function init(params) {
      this.list = params.list;
      this.map = params.map;
      this.targetList = params.targetList;
      ListManager.prototype.init.apply(this, arguments);
    },
    calculate: function calculate() {
      core.removeAll(this.targetList);
      event.addEventHandler(this.list, 'splice', this, this.spliceHandler);
      event.addEventHandler(this.list, 'push', this, this.pushHandler);

      for (var i = 0; i < this.list.length; ++i) {
        this.adminList.push(this.createAdmin(this.list, this.targetList, i));
      }
    },
    createAdmin: function createAdmin(list, targetList, index) {
      var admin = {
        list: list,
        targetList: targetList,
        index: index,
        calculatedProperty: null
      };
      admin.calculatedProperty = new CalculatedProperty({
        start: true,
        calc: function () {
          return this.map(admin.list[admin.index]);
        }.bind(this),
        callback: function (value) {
          core.splice(admin.targetList, admin.index, 1, [value]);
        }.bind(this)
      });
      return admin;
    },
    spliceHandler: function spliceHandler(signal, spliceArgs) {
      var index = spliceArgs[0];
      var numDel = spliceArgs[1];
      var insertElements = spliceArgs.slice(2);

      for (var i = 0; i < numDel; ++i) {
        var admin = this.adminList[index + i];
        admin.calculatedProperty.stop();
      }

      var insertAdmin = [];
      var insertTargetList = [];

      for (i = 0; i < insertElements.length; ++i) {
        insertAdmin.push(this.createAdmin(insertElements, insertTargetList, i));
      }

      core.splice(this.adminList, index, numDel, insertAdmin);

      for (i = index; i < index + insertElements.length; ++i) {
        var admin = this.adminList[i];
        admin.list = this.list;
        admin.targetList = this.targetList;
        admin.index = index;
      }

      for (i = index + insertElements.length; i < this.adminList.length; ++i) {
        var admin = this.adminList[i];
        admin.index += insertElements.length - numDel;
      }

      core.splice(this.targetList, index, numDel, insertTargetList);
    }
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy90dC9saXN0L01hcHBlZExpc3RNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbImRlZmluZSIsImNvcmUiLCJldmVudCIsIkxpc3RNYW5hZ2VyIiwiQ2FsY3VsYXRlZFByb3BlcnR5IiwiZGVmaW5lRGVyaXZlZENsYXNzIiwiaW5pdCIsInBhcmFtcyIsImxpc3QiLCJtYXAiLCJ0YXJnZXRMaXN0IiwicHJvdG90eXBlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJjYWxjdWxhdGUiLCJyZW1vdmVBbGwiLCJhZGRFdmVudEhhbmRsZXIiLCJzcGxpY2VIYW5kbGVyIiwicHVzaEhhbmRsZXIiLCJpIiwibGVuZ3RoIiwiYWRtaW5MaXN0IiwicHVzaCIsImNyZWF0ZUFkbWluIiwiaW5kZXgiLCJhZG1pbiIsImNhbGN1bGF0ZWRQcm9wZXJ0eSIsInN0YXJ0IiwiY2FsYyIsImJpbmQiLCJjYWxsYmFjayIsInZhbHVlIiwic3BsaWNlIiwic2lnbmFsIiwic3BsaWNlQXJncyIsIm51bURlbCIsImluc2VydEVsZW1lbnRzIiwic2xpY2UiLCJzdG9wIiwiaW5zZXJ0QWRtaW4iLCJpbnNlcnRUYXJnZXRMaXN0Il0sIm1hcHBpbmdzIjoiOztBQUFBQSxNQUFNLENBQUMsQ0FBQyxpQkFBRCxFQUFvQixrQkFBcEIsRUFBd0MsZUFBeEMsRUFBeUQsZ0NBQXpELENBQUQsRUFBNkYsVUFBVUMsSUFBVixFQUFnQkMsS0FBaEIsRUFBdUJDLFdBQXZCLEVBQW9DQyxrQkFBcEMsRUFBd0Q7QUFFdkosU0FBT0gsSUFBSSxDQUFDSSxrQkFBTCxDQUF3QkYsV0FBeEIsRUFBcUM7QUFFeENHLElBQUFBLElBQUksRUFBRSxjQUFVQyxNQUFWLEVBQWtCO0FBQ3BCLFdBQUtDLElBQUwsR0FBWUQsTUFBTSxDQUFDQyxJQUFuQjtBQUNBLFdBQUtDLEdBQUwsR0FBV0YsTUFBTSxDQUFDRSxHQUFsQjtBQUNBLFdBQUtDLFVBQUwsR0FBa0JILE1BQU0sQ0FBQ0csVUFBekI7QUFDQVAsTUFB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aUJhLGNBQWpCLEVBQWlDSSxnQkFBakMsRUFBbURyQixDQUFuRCxDQUFqQjtBQUNIOztBQUNEbEIsTUFBQUEsSUFBSSxDQUFDK0IsTUFBTCxDQUFZLEtBQUtYLFNBQWpCLEVBQTRCRyxLQUE1QixFQUFtQ1csTUFBbkMsRUFBMkNJLFdBQTNDOztBQUNBLFdBQUtwQixDQUFDLEdBQUdLLEtBQVQsRUFBZ0JMLENBQUMsR0FBR0ssS0FBSyxHQUFHWSxjQUFjLENBQUNoQixNQUEzQyxFQUFtRCxFQUFFRCxDQUFyRCxFQUF3RDtBQUNwRCxZQUFJTSxLQUFLLEdBQUcsS0FBS0osU0FBTCxDQUFlRixDQUFmLENBQVo7QUFDQU0sUUFBQUEsS0FBSyxDQUFDakIsSUFBTixHQUFhLEtBQUtBLElBQWxCO0FBQ0FpQixRQUFBQSxLQUFLLENBQUNmLFVBQU4sR0FBbUIsS0FBS0EsVUFBeEI7QUFDQWUsUUFBQUEsS0FBSyxDQUFDRCxLQUFOLEdBQWNBLEtBQWQ7QUFDSDs7QUFDRCxXQUFLTCxDQUFDLEdBQUdLLEtBQUssR0FBR1ksY0FBYyxDQUFDaEIsTUFBaEMsRUFBd0NELENBQUMsR0FBRyxLQUFLRSxTQUFMLENBQWVELE1BQTNELEVBQW1FLEVBQUVELENBQXJFLEVBQXdFO0FBQ3BFLFlBQUlNLEtBQUssR0FBRyxLQUFLSixTQUFMLENBQWVGLENBQWYsQ0FBWjtBQUNBTSxRQUFBQSxLQUFLLENBQUNELEtBQU4sSUFBZVksY0FBYyxDQUFDaEIsTUFBZixHQUF3QmUsTUFBdkM7QUFDSDs7QUFDRGxDLE1BQUFBLElBQUksQ0FBQytCLE1BQUwsQ0FBWSxLQUFLdEIsVUFBakIsRUFBNkJjLEtBQTdCLEVBQW9DVyxNQUFwQyxFQUE0Q0ssZ0JBQTVDO0FBQ0g7QUE5RHVDLEdBQXJDLENBQVA7QUFrRUgsQ0FwRUssQ0FBTiIsInNvdXJjZXNDb250ZW50IjpbImRlZmluZShbJy4uLy4uL2NvcmUvY29yZScsICcuLi8uLi9jb3JlL2V2ZW50JywgJy4vTGlzdE1hbmFnZXInLCAnLi4vcHJvcGVydHkvQ2FsY3VsYXRlZFByb3BlcnR5J10sIGZ1bmN0aW9uIChjb3JlLCBldmVudCwgTGlzdE1hbmFnZXIsIENhbGN1bGF0ZWRQcm9wZXJ0eSkge1xuXG4gICAgcmV0dXJuIGNvcmUuZGVmaW5lRGVyaXZlZENsYXNzKExpc3RNYW5hZ2VyLCB7XG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgdGhpcy5saXN0ID0gcGFyYW1zLmxpc3Q7XG4gICAgICAgICAgICB0aGlzLm1hcCA9IHBhcmFtcy5tYXA7XG4gICAgICAgICAgICB0aGlzLnRhcmdldExpc3QgPSBwYXJhbXMudGFyZ2V0TGlzdDtcbiAgICAgICAgICAgIExpc3RNYW5hZ2VyLnByb3RvdHlwZS5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FsY3VsYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb3JlLnJlbW92ZUFsbCh0aGlzLnRhcmdldExpc3QpO1xuICAgICAgICAgICAgZXZlbnQuYWRkRXZlbnRIYW5kbGVyKHRoaXMubGlzdCwgJ3NwbGljZScsIHRoaXMsIHRoaXMuc3BsaWNlSGFuZGxlcik7XG4gICAgICAgICAgICBldmVudC5hZGRFdmVudEhhbmRsZXIodGhpcy5saXN0LCAncHVzaCcsIHRoaXMsIHRoaXMucHVzaEhhbmRsZXIpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkbWluTGlzdC5wdXNoKHRoaXMuY3JlYXRlQWRtaW4odGhpcy5saXN0LCB0aGlzLnRhcmdldExpc3QsIGkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGVBZG1pbjogZnVuY3Rpb24gKGxpc3QsIHRhcmdldExpc3QsIGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgYWRtaW4gPSB7XG4gICAgICAgICAgICAgICAgbGlzdDogbGlzdCxcbiAgICAgICAgICAgICAgICB0YXJnZXRMaXN0OiB0YXJnZXRMaXN0LFxuICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleCxcbiAgICAgICAgICAgICAgICBjYWxjdWxhdGVkUHJvcGVydHk6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhZG1pbi5jYWxjdWxhdGVkUHJvcGVydHkgPSBuZXcgQ2FsY3VsYXRlZFByb3BlcnR5KHtcbiAgICAgICAgICAgICAgICBzdGFydDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjYWxjOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcChhZG1pbi5saXN0W2FkbWluLmluZGV4XSk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29yZS5zcGxpY2UoYWRtaW4udGFyZ2V0TGlzdCwgYWRtaW4uaW5kZXgsIDEsIFt2YWx1ZV0pO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gYWRtaW47XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3BsaWNlSGFuZGxlcjogZnVuY3Rpb24gKHNpZ25hbCwgc3BsaWNlQXJncykge1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gc3BsaWNlQXJnc1swXTtcbiAgICAgICAgICAgIHZhciBudW1EZWwgPSBzcGxpY2VBcmdzWzFdO1xuICAgICAgICAgICAgdmFyIGluc2VydEVsZW1lbnRzID0gc3BsaWNlQXJncy5zbGljZSgyKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtRGVsOyArK2kpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWRtaW4gPSB0aGlzLmFkbWluTGlzdFtpbmRleCArIGldO1xuICAgICAgICAgICAgICAgIGFkbWluLmNhbGN1bGF0ZWRQcm9wZXJ0eS5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgaW5zZXJ0QWRtaW4gPSBbXTtcbiAgICAgICAgICAgIHZhciBpbnNlcnRUYXJnZXRMaXN0ID0gW107XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaW5zZXJ0RWxlbWVudHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBpbnNlcnRBZG1pbi5wdXNoKHRoaXMuY3JlYXRlQWRtaW4oaW5zZXJ0RWxlbWVudHMsIGluc2VydFRhcmdldExpc3QsIGkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvcmUuc3BsaWNlKHRoaXMuYWRtaW5MaXN0LCBpbmRleCwgbnVtRGVsLCBpbnNlcnRBZG1pbik7XG4gICAgICAgICAgICBmb3IgKGkgPSBpbmRleDsgaSA8IGluZGV4ICsgaW5zZXJ0RWxlbWVudHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWRtaW4gPSB0aGlzLmFkbWluTGlzdFtpXTtcbiAgICAgICAgICAgICAgICBhZG1pbi5saXN0ID0gdGhpcy5saXN0O1xuICAgICAgICAgICAgICAgIGFkbWluLnRhcmdldExpc3QgPSB0aGlzLnRhcmdldExpc3Q7XG4gICAgICAgICAgICAgICAgYWRtaW4uaW5kZXggPSBpbmRleDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoaSA9IGluZGV4ICsgaW5zZXJ0RWxlbWVudHMubGVuZ3RoOyBpIDwgdGhpcy5hZG1pbkxpc3QubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWRtaW4gPSB0aGlzLmFkbWluTGlzdFtpXTtcbiAgICAgICAgICAgICAgICBhZG1pbi5pbmRleCArPSBpbnNlcnRFbGVtZW50cy5sZW5ndGggLSBudW1EZWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb3JlLnNwbGljZSh0aGlzLnRhcmdldExpc3QsIGluZGV4LCBudW1EZWwsIGluc2VydFRhcmdldExpc3QpO1xuICAgICAgICB9XG5cbiAgICB9KTtcblxufSk7Il19