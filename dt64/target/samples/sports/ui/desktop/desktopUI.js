"use strict";

define(['../../../../src/index', '../../model/WorkoutItem', '../../model/WorkoutItemCollection', '../../model/WorkoutBasic', './exercise', './workout', './movement', './muscle', '../../../../controls/tree/tree', '../../../../controls/util', '../../model/Model', '../../model/ExerciseBasic'], function (tt, WorkoutItem, WorkoutItemCollection, WorkoutBasic, exerciseUi, workoutUi, movementUi, musclesUi, tree, controlsUtil, Model, ExerciseBasic) {
  var DesktopUITtNodeRenderer = tt.core.defineClass({
    init: function init(model) {
      this.model = model;
      tt.initProperty(this, 'detail');
    },
    render: function render() {
      return tt.createTtNode({
        type: 'div',
        children: [this.createToolbarTtNode(), this.createTreeAndDetailTtNode()]
      });
    },
    createToolbarTtNode: function createToolbarTtNode() {
      return tt.createTtNode({
        type: 'div',
        css: ['buttons'],
        children: [tt.createTtNode({
          type: 'button',
          css: ['button'],
          text: 'Load',
          click: function () {
            this.model.load();
          }.bind(this)
        }), tt.createTtNode({
          type: 'button',
          css: ['button'],
          text: 'Save',
          click: function () {
            this.model.save();
          }.bind(this)
        })]
      });
    },
    createTreeAndDetailTtNode: function createTreeAndDetailTtNode(model) {
      return tt.createTtNode({
        type: 'div',
        css: [],
        children: [tt.createTtNode({
          type: 'div',
          css: [],
          children: [this.createDetailTtNode()]
        }), tt.createTtNode({
          type: 'br',
          css: []
        }), tt.createTtNode({
          type: 'div',
          css: ['columns'],
          children: [tt.createTtNode({
            type: 'div',
            css: ['column', 'is-half'],
            children: [this.createTreeTtNode()]
          }), tt.createTtNode({
            type: 'div',
            css: ['column', 'is-half'],
            children: [this.createTreeTtNode()]
          })]
        })]
      });
    },
    createTreeTtNode: function createTreeTtNode() {
      var rootChildNodes = tt.createMappedList([0, 1, 2, 3], function (index) {
        var root = this.model.getRoot();

        switch (index) {
          case 0:
            return exerciseUi.createExerciseTreeNode({
              exercise: root.exercise,
              ui: this
            });

          case 1:
            return workoutUi.createWorkoutTreeNode({
              workout: root.workout,
              ui: this
            });

          case 2:
            return movementUi.createMovementTreeNode({
              movement: root.movement,
              ui: this
            });

          case 3:
            return musclesUi.createMuscleTreeNode({
              muscle: root.muscle,
              ui: this
            });
        }
      }.bind(this));
      return controlsUtil.createWidgetTtNode({
        header: 'All',
        body: [tt.createTtNode({
          type: 'div',
          css: ['content', 'tree-container'],
          children: [tree.createTreeTtNode({
            labelTtNodes: [controlsUtil.createLabelTtNode('All')],
            childNodes: rootChildNodes
          })]
        })]
      });
    },
    createDetailTtNode: function createDetailTtNode() {
      return controlsUtil.createWidgetTtNode({
        header: 'Detail',
        body: function () {
          var body = [];
          var detail = this.getDetail();

          if (!detail) {
            return body;
          }

          tt.initProperty(detail, 'deleted');
          var deleted = detail.getDeleted();

          if (deleted) {
            return body;
          }

          if (detail instanceof WorkoutItem) {
            body.push(workoutUi.createWorkoutItemDetailTtNode({
              item: detail
            }));
          }

          if (detail instanceof WorkoutItemCollection) {
            body.push(workoutUi.createWorkoutItemCollectionDetailTtNode({
              itemCollection: detail
            }));
          }

          if (detail instanceof WorkoutBasic) {
            body.push(workoutUi.createWorkoutBasicDetailTtNode({
              workout: detail
            }));
          }

          if (detail instanceof ExerciseBasic) {
            body.push(exerciseUi.createExerciseBasicDetailTtNode({
              exerciseBasic: detail
            }));
          }

          return body;
        }.bind(this)
      });
    }
  });
  return {
    createTtNode: tt.createTtNodeCreator(DesktopUITtNodeRenderer),
    start: function start() {
      var model = new Model();
      document.getElementById('rootContainer').appendChild(this.createTtNode(model).getDomNode());
      model.load();
    }
  };
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NhbXBsZXMvc3BvcnRzL3VpL2Rlc2t0b3AvZGVza3RvcFVJLmpzIl0sIm5hbWVzIjpbImRlZmluZSIsInR0IiwiV29ya291dEl0ZW0iLCJXb3Jrb3V0SXRlbUNvbGxlY3Rpb24iLCJXb3Jrb3V0QmFzaWMiLCJleGVyY2lzZVVpIiwid29ya291dFVpIiwibW92ZW1lbnRVaSIsIm11c2NsZXNVaSIsInRyZWUiLCJjb250cm9sc1V0aWwiLCJNb2RlbCIsIkV4ZXJjaXNlQmFzaWMiLCJEZXNrdG9wVUlUdE5vZGVSZW5kZXJlciIsImNvcmUiLCJkZWZpbmVDbGFzcyIsImluaXQiLCJtb2RlbCIsImluaXRQcm9wZXJ0eSIsInJlbmRlciIsImNyZWF0ZVR0Tm9kZSIsInR5cGUiLCJjaGlsZHJlbiIsImNyZWF0ZVRvb2xiYXJUdE5vZGUiLCJjcmVhdGVUcmVlQW5kRGV0YWlsVHROb2RlIiwiY3NzIiwidGV4dCIsImNsaWNrIiwibG9hZCIsImJpbmQiLCJzYXZlIiwiY3JlYXRlRGV0YWlsVHROb2RlIiwiY3JlYXRlVHJlZVR0Tm9kZSIsInJvb3RDaGlsZE5vZGVzIiwiY3JlYXRlTWFwcGVkTGlzdCIsImluZGV4Iiwicm9vdCIsImdldFJvb3QiLCJjcmVhdGVFeGVyY2lzZVRyZWVOb2RlIiwiZXhlcmNpc2UiLCJ1aSIsImNyZWF0ZVdvcmtvdXRUcmVlTm9kZSIsIndvcmtvdXQiLCJjcmVhdGVNb3ZlbWVudFRyZWVOb2RlIiwibW92ZW1lbnQiLCJjcmVhdGVNdXNjbGVUcmVlTm9kZSIsIm11c2NsZSIsImNyZWF0ZVdpZGdldFR0Tm9kZSIsImhlYWRlciIsImJvZHkiLCJsYWJlbFR0Tm9kZXMiLCJjcmVhdGVMYWJlbFR0Tm9kZSIsImNoaWxkTm9kZXMiLCJkZXRhaWwiLCJnZXREZXRhaWwiLCJkZWxldGVkIiwiZ2V0RGVsZXRlZCIsInB1c2giLCJjcmVhdGVXb3Jrb3V0SXRlbURldGFpbFR0Tm9kZSIsIml0ZW0iLCJjcmVhdGVXb3Jrb3V0SXRlbUNvbGxlY3Rpb25EZXRhaWxUdE5vZGUiLCJpdGVtQ29sbGVjdGlvbiIsImNyZWF0ZVdvcmtvdXRCYXNpY0RldGFpbFR0Tm9kZSIsImNyZWF0ZUV4ZXJjaXNlQmFzaWNEZXRhaWxUdE5vZGUiLCJleGVyY2lzZUJhc2ljIiwiY3JlYXRlVHROb2RlQ3JlYXRvciIsInN0YXJ0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImFwcGVuZENoaWxkIiwiZ2V0RG9tTm9kZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQUEsTUFBTSxDQUFDLENBQUMsdUJBQUQsRUFBMEIseUJBQTFCLEVBQXFELG1DQUFyRCxFQUEwRiwwQkFBMUYsRUFBc0gsWUFBdEgsRUFBb0ksV0FBcEksRUFBaUosWUFBakosRUFBK0osVUFBL0osRUFBMkssZ0NBQTNLLEVBQTZNLDJCQUE3TSxFQUEwTyxtQkFBMU8sRUFBK1AsMkJBQS9QLENBQUQsRUFDRixVQUFVQyxFQUFWLEVBQWNDLFdBQWQsRUFBMkJDLHFCQUEzQixFQUFrREMsWUFBbEQsRUFBZ0VDLFVBQWhFLEVBQTRFQyxTQUE1RSxFQUF1RkMsVUFBdkYsRUFBbUdDLFNBQW5HLEVBQThHQyxJQUE5RyxFQUFvSEMsWUFBcEgsRUFBa0lDLEtBQWxJLEVBQXlJQyxhQUF6SSxFQUF3SjtBQUVwSixNQUFJQyx1QkFBdUIsR0FBR1osRUFBRSxDQUFDYSxJQUFILENBQVFDLFdBQVIsQ0FBb0I7QUFFOUNDLElBQUFBLElBQUksRUFBRSxjQUFVQyxLQUFWLEVBQWlCO0FBQ25CLFdBQUtBLEtBQUwsR0FBYUEsS0FBYjtBQUNBaEIsTUFBQUEsRUFBRSxDQUFDaUIsWUFBSCxDQUFnQixJQUFoQixFQUFzQixRQUF0QjtBQUNILEtBTDZDO0FBTzlDQyxJQUFBQSxNQUFNLEVBQUUsa0JBQVk7QUFDaEIsYUFBT2xCLEVBQUUsQ0FBQ21CLFlBQUgsQ0FBZ0I7QUFDbkJDLFFBQUFBLElBQUksRUFBRSxLQURhO0FBRW5CQyxRQUFBQSxRQUFRLEVBQUUsQ0FDTixLQUFLQyxtQkFBTCxFQURNLEVBRU4sS0FBS0Ms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QixFQUFxQztBQUNqQ3FDLFlBQUFBLElBQUksQ0FBQ1EsSUFBTCxDQUFVcEQsVUFBVSxDQUFDMEQsK0JBQVgsQ0FBMkM7QUFBRUMsY0FBQUEsYUFBYSxFQUFFWDtBQUFqQixhQUEzQyxDQUFWO0FBQ0g7O0FBQ0QsaUJBQU9KLElBQVA7QUFDSCxTQXhCSyxDQXdCSnBCLElBeEJJLENBd0JDLElBeEJEO0FBRjZCLE9BQWhDLENBQVA7QUE0Qkg7QUF0STZDLEdBQXBCLENBQTlCO0FBMElBLFNBQU87QUFDSFQsSUFBQUEsWUFBWSxFQUFFbkIsRUFBRSxDQUFDZ0UsbUJBQUgsQ0FBdUJwRCx1QkFBdkIsQ0FEWDtBQUVIcUQsSUFBQUEsS0FBSyxFQUFFLGlCQUFZO0FBQ2YsVUFBSWpELEtBQUssR0FBRyxJQUFJTixLQUFKLEVBQVo7QUFDQXdELE1BQUFBLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3QixlQUF4QixFQUF5Q0MsV0FBekMsQ0FBcUQsS0FBS2pELFlBQUwsQ0FBa0JILEtBQWxCLEVBQXlCcUQsVUFBekIsRUFBckQ7QUFDQXJELE1BQUFBLEtBQUssQ0FBQ1csSUFBTjtBQUNIO0FBTkUsR0FBUDtBQVVILENBdkpDLENBQU4iLCJzb3VyY2VzQ29udGVudCI6WyJkZWZpbmUoWycuLi8uLi8uLi8uLi9zcmMvaW5kZXgnLCAnLi4vLi4vbW9kZWwvV29ya291dEl0ZW0nLCAnLi4vLi4vbW9kZWwvV29ya291dEl0ZW1Db2xsZWN0aW9uJywgJy4uLy4uL21vZGVsL1dvcmtvdXRCYXNpYycsICcuL2V4ZXJjaXNlJywgJy4vd29ya291dCcsICcuL21vdmVtZW50JywgJy4vbXVzY2xlJywgJy4uLy4uLy4uLy4uL2NvbnRyb2xzL3RyZWUvdHJlZScsICcuLi8uLi8uLi8uLi9jb250cm9scy91dGlsJywgJy4uLy4uL21vZGVsL01vZGVsJywgJy4uLy4uL21vZGVsL0V4ZXJjaXNlQmFzaWMnXSxcbiAgICBmdW5jdGlvbiAodHQsIFdvcmtvdXRJdGVtLCBXb3Jrb3V0SXRlbUNvbGxlY3Rpb24sIFdvcmtvdXRCYXNpYywgZXhlcmNpc2VVaSwgd29ya291dFVpLCBtb3ZlbWVudFVpLCBtdXNjbGVzVWksIHRyZWUsIGNvbnRyb2xzVXRpbCwgTW9kZWwsIEV4ZXJjaXNlQmFzaWMpIHtcblxuICAgICAgICB2YXIgRGVza3RvcFVJVHROb2RlUmVuZGVyZXIgPSB0dC5jb3JlLmRlZmluZUNsYXNzKHtcblxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24gKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgICAgICAgICAgICAgIHR0LmluaXRQcm9wZXJ0eSh0aGlzLCAnZGV0YWlsJyk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVRvb2xiYXJUdE5vZGUoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVHJlZUFuZERldGFpbFR0Tm9kZSgpXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGNyZWF0ZVRvb2xiYXJUdE5vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgIGNzczogWydidXR0b25zJ10sXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdidXR0b24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzczogWydidXR0b24nXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnTG9hZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5sb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ2J1dHRvbiddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdTYXZlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGNyZWF0ZVRyZWVBbmREZXRhaWxUdE5vZGU6IGZ1bmN0aW9uIChtb2RlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgY3NzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpdicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW3RoaXMuY3JlYXRlRGV0YWlsVHROb2RlKCldXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2JyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3M6IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0dC5jcmVhdGVUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzczogWydjb2x1bW5zJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ2NvbHVtbicsICdpcy1oYWxmJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW3RoaXMuY3JlYXRlVHJlZVR0Tm9kZSgpXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHQuY3JlYXRlVHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzOiBbJ2NvbHVtbicsICdpcy1oYWxmJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW3RoaXMuY3JlYXRlVHJlZVR0Tm9kZSgpXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGNyZWF0ZVRyZWVUdE5vZGU6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIHZhciByb290Q2hpbGROb2RlcyA9IHR0LmNyZWF0ZU1hcHBlZExpc3QoWzAsIDEsIDIsIDNdLCBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvb3QgPSB0aGlzLm1vZGVsLmdldFJvb3QoKTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBleGVyY2lzZVVpLmNyZWF0ZUV4ZXJjaXNlVHJlZU5vZGUoeyBleGVyY2lzZTogcm9vdC5leGVyY2lzZSwgdWk6IHRoaXMgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtvdXRVaS5jcmVhdGVXb3Jrb3V0VHJlZU5vZGUoeyB3b3Jrb3V0OiByb290LndvcmtvdXQsIHVpOiB0aGlzIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtb3ZlbWVudFVpLmNyZWF0ZU1vdmVtZW50VHJlZU5vZGUoeyBtb3ZlbWVudDogcm9vdC5tb3ZlbWVudCwgdWk6IHRoaXMgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG11c2NsZXNVaS5jcmVhdGVNdXNjbGVUcmVlTm9kZSh7IG11c2NsZTogcm9vdC5tdXNjbGUsIHVpOiB0aGlzIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBjb250cm9sc1V0aWwuY3JlYXRlV2lkZ2V0VHROb2RlKHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiAnQWxsJyxcbiAgICAgICAgICAgICAgICAgICAgYm9keTogW3R0LmNyZWF0ZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGl2JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNzczogWydjb250ZW50JywgJ3RyZWUtY29udGFpbmVyJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW3RyZWUuY3JlYXRlVHJlZVR0Tm9kZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxUdE5vZGVzOiBbY29udHJvbHNVdGlsLmNyZWF0ZUxhYmVsVHROb2RlKCdBbGwnKV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGROb2Rlczogcm9vdENoaWxkTm9kZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXVxuICAgICAgICAgICAgICAgICAgICB9KV1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgY3JlYXRlRGV0YWlsVHROb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRyb2xzVXRpbC5jcmVhdGVXaWRnZXRUdE5vZGUoe1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXI6ICdEZXRhaWwnLFxuICAgICAgICAgICAgICAgICAgICBib2R5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYm9keSA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRldGFpbCA9IHRoaXMuZ2V0RGV0YWlsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRldGFpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBib2R5O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdHQuaW5pdFByb3BlcnR5KGRldGFpbCwgJ2RlbGV0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWxldGVkID0gZGV0YWlsLmdldERlbGV0ZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJvZHk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGV0YWlsIGluc3RhbmNlb2YgV29ya291dEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5LnB1c2god29ya291dFVpLmNyZWF0ZVdvcmtvdXRJdGVtRGV0YWlsVHROb2RlKHsgaXRlbTogZGV0YWlsIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXRhaWwgaW5zdGFuY2VvZiBXb3Jrb3V0SXRlbUNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5LnB1c2god29ya291dFVpLmNyZWF0ZVdvcmtvdXRJdGVtQ29sbGVjdGlvbkRldGFpbFR0Tm9kZSh7IGl0ZW1Db2xsZWN0aW9uOiBkZXRhaWwgfSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRldGFpbCBpbnN0YW5jZW9mIFdvcmtvdXRCYXNpYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkucHVzaCh3b3Jrb3V0VWkuY3JlYXRlV29ya291dEJhc2ljRGV0YWlsVHROb2RlKHsgd29ya291dDogZGV0YWlsIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXRhaWwgaW5zdGFuY2VvZiBFeGVyY2lzZUJhc2ljKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keS5wdXNoKGV4ZXJjaXNlVWkuY3JlYXRlRXhlcmNpc2VCYXNpY0RldGFpbFR0Tm9kZSh7IGV4ZXJjaXNlQmFzaWM6IGRldGFpbCB9KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYm9keTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY3JlYXRlVHROb2RlOiB0dC5jcmVhdGVUdE5vZGVDcmVhdG9yKERlc2t0b3BVSVR0Tm9kZVJlbmRlcmVyKSxcbiAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gbmV3IE1vZGVsKCk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jvb3RDb250YWluZXInKS5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZVR0Tm9kZShtb2RlbCkuZ2V0RG9tTm9kZSgpKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5sb2FkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cblxuICAgIH0pO1xuIl19